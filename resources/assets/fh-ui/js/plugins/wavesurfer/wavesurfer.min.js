(function e(t,r){if(typeof exports==="object"&&typeof module==="object")module.exports=r();else if(typeof define==="function"&&define.amd)define([],r);else t["WaveSurfer"]=r()})(window,function(){return function(e){var t={};function r(i){if(t[i]){return t[i].exports}var a=t[i]={i:i,l:false,exports:{}};e[i].call(a.exports,a,a.exports,r);a.l=true;return a.exports}r.m=e;r.c=t;r.d=function(e,t,i){if(!r.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:i})}};r.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};r.t=function(e,t){if(t&1)e=r(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var i=Object.create(null);r.r(i);Object.defineProperty(i,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(e,t){e.exports=function e(t,r,i){var a,n,s,o,u;if(null==r)r=100;function l(){var e=Date.now()-o;if(e<r&&e>=0){a=setTimeout(l,r-e)}else{a=null;if(!i){u=t.apply(s,n);s=n=null}}}var c=function(){s=this;n=arguments;o=Date.now();var e=i&&!a;if(!a)a=setTimeout(l,r);if(e){u=t.apply(s,n);s=n=null}return u};c.clear=function(){if(a){clearTimeout(a);a=null}};c.flush=function(){if(a){u=t.apply(s,n);s=n=null;clearTimeout(a);a=null}};return c}},"./src/drawer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=r("./src/util/index.js");var n=s(a);function s(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){l(t,e);function t(e,r){o(this,t);var i=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.container=e;i.params=r;i.width=0;i.height=r.height*i.params.pixelRatio;i.lastPos=0;i.wrapper=null;return i}i(t,[{key:"style",value:function e(t,r){return n.style(t,r)}},{key:"createWrapper",value:function e(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"})}this.setupWrapperEvents()}},{key:"handleEvent",value:function e(t,r){!r&&t.preventDefault();var i=t.targetTouches?t.targetTouches[0].clientX:t.clientX;var a=this.wrapper.getBoundingClientRect();var n=this.width;var s=this.getWidth();var o=void 0;if(!this.params.fillParent&&n<s){o=(i-a.left)*(this.params.pixelRatio/n)||0;if(o>1){o=1}}else{o=(i-a.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0}return o}},{key:"setupWrapperEvents",value:function e(){var t=this;this.wrapper.addEventListener("click",function(e){var r=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(r!=0){var i=t.wrapper.getBoundingClientRect();if(e.clientY>=i.bottom-r){return}}if(t.params.interact){t.fireEvent("click",e,t.handleEvent(e))}});this.wrapper.addEventListener("scroll",function(e){return t.fireEvent("scroll",e)})}},{key:"drawPeaks",value:function e(t,r,i,a){if(!this.setWidth(r)){this.clearWave()}this.params.barWidth?this.drawBars(t,0,i,a):this.drawWave(t,0,i,a)}},{key:"resetScroll",value:function e(){if(this.wrapper!==null){this.wrapper.scrollLeft=0}}},{key:"recenter",value:function e(t){var r=this.wrapper.scrollWidth*t;this.recenterOnPosition(r,true)}},{key:"recenterOnPosition",value:function e(t,r){var i=this.wrapper.scrollLeft;var a=~~(this.wrapper.clientWidth/2);var n=this.wrapper.scrollWidth-this.wrapper.clientWidth;var s=t-a;var o=s-i;if(n==0){return}if(!r&&-a<=o&&o<a){var u=5;o=Math.max(-u,Math.min(u,o));s=i+o}s=Math.max(0,Math.min(n,s));if(s!=i){this.wrapper.scrollLeft=s}}},{key:"getScrollX",value:function e(){var t=this.params.pixelRatio;var r=Math.round(this.wrapper.scrollLeft*t);if(this.params.scrollParent){var i=~~(this.wrapper.scrollWidth*t-this.getWidth());r=Math.min(i,Math.max(0,r))}return r}},{key:"getWidth",value:function e(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function e(t){if(this.width==t){return false}this.width=t;if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:""})}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"})}this.updateSize();return true}},{key:"setHeight",value:function e(t){if(t==this.height){return false}this.height=t;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize();return true}},{key:"progress",value:function e(t){var r=1/this.params.pixelRatio;var i=Math.round(t*this.width)*r;if(i<this.lastPos||i-this.lastPos>=r){this.lastPos=i;if(this.params.scrollParent&&this.params.autoCenter){var a=~~(this.wrapper.scrollWidth*t);this.recenterOnPosition(a)}this.updateProgress(i)}}},{key:"destroy",value:function e(){this.unAll();if(this.wrapper){if(this.wrapper.parentNode==this.container){this.container.removeChild(this.wrapper)}this.wrapper=null}}},{key:"updateCursor",value:function e(){}},{key:"updateSize",value:function e(){}},{key:"drawBars",value:function e(t,r,i,a){}},{key:"drawWave",value:function e(t,r,i,a){}},{key:"clearWave",value:function e(){}},{key:"updateProgress",value:function e(t){}}]);return t}(n.Observer);t.default=c;e.exports=t["default"]},"./src/drawer.multicanvas.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=r("./src/drawer.js");var n=l(a);var s=r("./src/util/index.js");var o=u(s);function u(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(e,r){c(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.maxCanvasWidth=r.maxCanvasWidth;i.maxCanvasElementWidth=Math.round(r.maxCanvasWidth/r.pixelRatio);i.hasProgressCanvas=r.waveColor!=r.progressColor;i.halfPixel=.5/r.pixelRatio;i.canvases=[];i.progressWave=null;return i}i(t,[{key:"init",value:function e(){this.createWrapper();this.createElements()}},{key:"createElements",value:function e(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}));this.addCanvas();this.updateCursor()}},{key:"updateCursor",value:function e(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function e(){var t=this;var r=Math.round(this.width/this.params.pixelRatio);var i=Math.ceil(r/this.maxCanvasElementWidth);while(this.canvases.length<i){this.addCanvas()}while(this.canvases.length>i){this.removeCanvas()}this.canvases.forEach(function(e,r){var i=t.maxCanvasWidth+2*Math.ceil(t.params.pixelRatio/2);if(r==t.canvases.length-1){i=t.width-t.maxCanvasWidth*(t.canvases.length-1)}t.updateDimensions(e,i,t.height);t.clearWaveForEntry(e)})}},{key:"addCanvas",value:function e(){var t={};var r=this.maxCanvasElementWidth*this.canvases.length;t.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:r+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}));t.waveCtx=t.wave.getContext("2d");if(this.hasProgressCanvas){t.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:r+"px",top:0,bottom:0,height:"100%"}));t.progressCtx=t.progress.getContext("2d")}this.canvases.push(t)}},{key:"removeCanvas",value:function e(){var t=this.canvases.pop();t.wave.parentElement.removeChild(t.wave);if(this.hasProgressCanvas){t.progress.parentElement.removeChild(t.progress)}}},{key:"updateDimensions",value:function e(t,r,i){var a=Math.round(r/this.params.pixelRatio);var n=Math.round(this.width/this.params.pixelRatio);t.start=t.waveCtx.canvas.offsetLeft/n||0;t.end=t.start+a/n;t.waveCtx.canvas.width=r;t.waveCtx.canvas.height=i;this.style(t.waveCtx.canvas,{width:a+"px"});this.style(this.progressWave,{display:"block"});if(this.hasProgressCanvas){t.progressCtx.canvas.width=r;t.progressCtx.canvas.height=i;this.style(t.progressCtx.canvas,{width:a+"px"})}}},{key:"clearWave",value:function e(){var t=this;this.canvases.forEach(function(e){return t.clearWaveForEntry(e)})}},{key:"clearWaveForEntry",value:function e(t){t.waveCtx.clearRect(0,0,t.waveCtx.canvas.width,t.waveCtx.canvas.height);if(this.hasProgressCanvas){t.progressCtx.clearRect(0,0,t.progressCtx.canvas.width,t.progressCtx.canvas.height)}}},{key:"drawBars",value:function e(t,r,i,a){var n=this;return this.prepareDraw(t,r,i,a,function(e){var t=e.absmax,r=e.hasMinVals,s=e.height,o=e.offsetY,u=e.halfH,l=e.peaks;if(i===undefined){return}var c=r?2:1;var f=l.length/c;var h=n.params.barWidth*n.params.pixelRatio;var d=n.params.barGap===null?Math.max(n.params.pixelRatio,~~(h/2)):Math.max(n.params.pixelRatio,n.params.barGap*n.params.pixelRatio);var p=h+d;var v=f/n.width;var y=i;var m=a;var k=void 0;for(k=y;k<m;k+=p){var g=l[Math.floor(k*v*c)]||0;var b=Math.round(g/t*u);n.fillRect(k+n.halfPixel,u-b+o,h+n.halfPixel,b*2)}})}},{key:"drawWave",value:function e(t,r,i,a){var n=this;return this.prepareDraw(t,r,i,a,function(e){var t=e.absmax,r=e.hasMinVals,s=e.height,o=e.offsetY,u=e.halfH,l=e.peaks;if(!r){var c=[];var f=l.length;var h=void 0;for(h=0;h<f;h++){c[2*h]=l[h];c[2*h+1]=-l[h]}l=c}if(i!==undefined){n.drawLine(l,t,u,o,i,a)}n.fillRect(0,u+o-n.halfPixel,n.width,n.halfPixel)})}},{key:"drawLine",value:function e(t,r,i,a,n,s){var o=this;this.canvases.forEach(function(e){o.setFillStyles(e);o.drawLineToContext(e,e.waveCtx,t,r,i,a,n,s);o.drawLineToContext(e,e.progressCtx,t,r,i,a,n,s)})}},{key:"drawLineToContext",value:function e(t,r,i,a,n,s,o,u){if(!r){return}var l=i.length/2;var c=this.params.fillParent&&this.width!=l?this.width/l:1;var f=Math.round(l*t.start);var h=Math.round(l*t.end)+1;if(f>u||h<o){return}var d=Math.min(f,o);var p=Math.max(h,u);var v=void 0;var y=void 0;r.beginPath();r.moveTo((d-f)*c+this.halfPixel,n+s);for(v=d;v<p;v++){var m=i[2*v]||0;var k=Math.round(m/a*n);r.lineTo((v-f)*c+this.halfPixel,n-k+s)}for(y=p-1;y>=d;y--){var g=i[2*y+1]||0;var b=Math.round(g/a*n);r.lineTo((y-f)*c+this.halfPixel,n-b+s)}r.closePath();r.fill()}},{key:"fillRect",value:function e(t,r,i,a){var n=Math.floor(t/this.maxCanvasWidth);var s=Math.min(Math.ceil((t+i)/this.maxCanvasWidth)+1,this.canvases.length);var o=void 0;for(o=n;o<s;o++){var u=this.canvases[o];var l=o*this.maxCanvasWidth;var c={x1:Math.max(t,o*this.maxCanvasWidth),y1:r,x2:Math.min(t+i,o*this.maxCanvasWidth+u.waveCtx.canvas.width),y2:r+a};if(c.x1<c.x2){this.setFillStyles(u);this.fillRectToContext(u.waveCtx,c.x1-l,c.y1,c.x2-c.x1,c.y2-c.y1);this.fillRectToContext(u.progressCtx,c.x1-l,c.y1,c.x2-c.x1,c.y2-c.y1)}}}},{key:"prepareDraw",value:function e(t,r,i,a,n){var s=this;return o.frame(function(){if(t[0]instanceof Array){var e=t;if(s.params.splitChannels){s.setHeight(e.length*s.params.height*s.params.pixelRatio);return e.forEach(function(e,t){return s.prepareDraw(e,t,i,a,n)})}t=e[0]}var u=1/s.params.barHeight;if(s.params.normalize){var l=o.max(t);var c=o.min(t);u=-c>l?-c:l}var f=[].some.call(t,function(e){return e<0});var h=s.params.height*s.params.pixelRatio;var d=h*r||0;var p=h/2;return n({absmax:u,hasMinVals:f,height:h,offsetY:d,halfH:p,peaks:t})})()}},{key:"fillRectToContext",value:function e(t,r,i,a,n){if(!t){return}t.fillRect(r,i,a,n)}},{key:"setFillStyles",value:function e(t){t.waveCtx.fillStyle=this.params.waveColor;if(this.hasProgressCanvas){t.progressCtx.fillStyle=this.params.progressColor}}},{key:"getImage",value:function e(t,r){var i=this.canvases.map(function(e){return e.wave.toDataURL(t,r)});return i.length>1?i:i[0]}},{key:"updateProgress",value:function e(t){this.style(this.progressWave,{width:t+"px"})}}]);return t}(n.default);t.default=d;e.exports=t["default"]},"./src/mediaelement.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=function e(t,r,i){if(t===null)t=Function.prototype;var a=Object.getOwnPropertyDescriptor(t,r);if(a===undefined){var n=Object.getPrototypeOf(t);if(n===null){return undefined}else{return e(n,r,i)}}else if("value"in a){return a.value}else{var s=a.get;if(s===undefined){return undefined}return s.call(i)}};var n=r("./src/webaudio.js");var s=c(n);var o=r("./src/util/index.js");var u=l(o);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function c(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){d(t,e);function t(e){f(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.params=e;r.media={currentTime:0,duration:0,paused:true,playbackRate:1,play:function e(){},pause:function e(){},volume:0};r.mediaType=e.mediaType.toLowerCase();r.elementPosition=e.elementPosition;r.peaks=null;r.playbackRate=1;r.volume=1;r.buffer=null;r.onPlayEnd=null;return r}i(t,[{key:"init",value:function e(){this.setPlaybackRate(this.params.audioRate);this.createTimer()}},{key:"createTimer",value:function e(){var t=this;var r=function e(){if(t.isPaused()){return}t.fireEvent("audioprocess",t.getCurrentTime());var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame;r(e)};this.on("play",r);this.on("pause",function(){t.fireEvent("audioprocess",t.getCurrentTime())})}},{key:"load",value:function e(t,r,i,a){var n=document.createElement(this.mediaType);n.controls=this.params.mediaControls;n.autoplay=this.params.autoplay||false;n.preload=a==null?"auto":a;n.src=t;n.style.width="100%";var s=r.querySelector(this.mediaType);if(s){r.removeChild(s)}r.appendChild(n);this._load(n,i)}},{key:"loadElt",value:function e(t,r){t.controls=this.params.mediaControls;t.autoplay=this.params.autoplay||false;this._load(t,r)}},{key:"_load",value:function e(t,r){var i=this;if(typeof t.load=="function"){t.load()}t.addEventListener("error",function(){i.fireEvent("error","Error loading media element")});t.addEventListener("canplay",function(){i.fireEvent("canplay")});t.addEventListener("ended",function(){i.fireEvent("finish")});t.addEventListener("play",function(){i.fireEvent("play")});t.addEventListener("pause",function(){i.fireEvent("pause")});this.media=t;this.peaks=r;this.onPlayEnd=null;this.buffer=null;this.setPlaybackRate(this.playbackRate);this.setVolume(this.volume)}},{key:"isPaused",value:function e(){return!this.media||this.media.paused}},{key:"getDuration",value:function e(){if(this.explicitDuration){return this.explicitDuration}var t=(this.buffer||this.media).duration;if(t>=Infinity){t=this.media.seekable.end(0)}return t}},{key:"getCurrentTime",value:function e(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function e(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function e(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function e(t){this.playbackRate=t||1;this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function e(t){if(t!=null){this.media.currentTime=t}this.clearPlayEnd()}},{key:"play",value:function e(t,r){this.seekTo(t);var i=this.media.play();r&&this.setPlayEnd(r);return i}},{key:"pause",value:function e(){var t=void 0;if(this.media){t=this.media.pause()}this.clearPlayEnd();return t}},{key:"setPlayEnd",value:function e(t){var r=this;this._onPlayEnd=function(e){if(e>=t){r.pause();r.seekTo(t)}};this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function e(){if(this._onPlayEnd){this.un("audioprocess",this._onPlayEnd);this._onPlayEnd=null}}},{key:"getPeaks",value:function e(r,i,n){if(this.buffer){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getPeaks",this).call(this,r,i,n)}return this.peaks||[]}},{key:"setSinkId",value:function e(t){if(t){if(!this.media.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}return this.media.setSinkId(t)}return Promise.reject(new Error("Invalid deviceId: "+t))}},{key:"getVolume",value:function e(){return this.volume||this.media.volume}},{key:"setVolume",value:function e(t){this.volume=t;this.media.volume=this.volume}},{key:"destroy",value:function e(){this.pause();this.unAll();if(this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode){this.media.parentNode.removeChild(this.media)}this.media=null}}]);return t}(s.default);t.default=p;e.exports=t["default"]},"./src/peakcache.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function e(){a(this,e);this.clearPeakCache()}i(e,[{key:"clearPeakCache",value:function e(){this.peakCacheRanges=[];this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function e(t,r,i){if(t!=this.peakCacheLength){this.clearPeakCache();this.peakCacheLength=t}var a=[];var n=0;while(n<this.peakCacheRanges.length&&this.peakCacheRanges[n]<r){n++}if(n%2==0){a.push(r)}while(n<this.peakCacheRanges.length&&this.peakCacheRanges[n]<=i){a.push(this.peakCacheRanges[n]);n++}if(n%2==0){a.push(i)}a=a.filter(function(e,t,r){if(t==0){return e!=r[t+1]}else if(t==r.length-1){return e!=r[t-1]}return e!=r[t-1]&&e!=r[t+1]});this.peakCacheRanges=this.peakCacheRanges.concat(a);this.peakCacheRanges=this.peakCacheRanges.sort(function(e,t){return e-t}).filter(function(e,t,r){if(t==0){return e!=r[t+1]}else if(t==r.length-1){return e!=r[t-1]}return e!=r[t-1]&&e!=r[t+1]});var s=[];for(n=0;n<a.length;n+=2){s.push([a[n],a[n+1]])}return s}},{key:"getCacheRanges",value:function e(){var t=[];var r=void 0;for(r=0;r<this.peakCacheRanges.length;r+=2){t.push([this.peakCacheRanges[r],this.peakCacheRanges[r+1]])}return t}}]);return e}();t.default=n;e.exports=t["default"]},"./src/util/ajax.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=s;var i=r("./src/util/observer.js");var a=n(i);function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=new a.default;var r=new XMLHttpRequest;var i=false;r.open(e.method||"GET",e.url,true);r.responseType=e.responseType||"json";if(e.xhr){if(e.xhr.requestHeaders){e.xhr.requestHeaders.forEach(function(e){r.setRequestHeader(e.key,e.value)})}if(e.xhr.withCredentials){r.withCredentials=true}}r.addEventListener("progress",function(e){t.fireEvent("progress",e);if(e.lengthComputable&&e.loaded==e.total){i=true}});r.addEventListener("load",function(e){if(!i){t.fireEvent("progress",e)}t.fireEvent("load",e);if(200==r.status||206==r.status){t.fireEvent("success",r.response,e)}else{t.fireEvent("error",e)}});r.addEventListener("error",function(e){return t.fireEvent("error",e)});r.send();t.xhr=r;return t}e.exports=t["default"]},"./src/util/extend.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=i;function i(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++){r[i-1]=arguments[i]}r.forEach(function(t){Object.keys(t).forEach(function(r){e[r]=t[r]})});return e}e.exports=t["default"]},"./src/util/frame.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=s;var i=r("./src/util/request-animation-frame.js");var a=n(i);function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++){r[i]=arguments[i]}return(0,a.default)(function(){return e.apply(undefined,r)})}}e.exports=t["default"]},"./src/util/get-id.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=i;function i(){return"wavesurfer_"+Math.random().toString(32).substring(2)}e.exports=t["default"]},"./src/util/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r("./src/util/ajax.js");Object.defineProperty(t,"ajax",{enumerable:true,get:function e(){return p(i).default}});var a=r("./src/util/get-id.js");Object.defineProperty(t,"getId",{enumerable:true,get:function e(){return p(a).default}});var n=r("./src/util/max.js");Object.defineProperty(t,"max",{enumerable:true,get:function e(){return p(n).default}});var s=r("./src/util/min.js");Object.defineProperty(t,"min",{enumerable:true,get:function e(){return p(s).default}});var o=r("./src/util/observer.js");Object.defineProperty(t,"Observer",{enumerable:true,get:function e(){return p(o).default}});var u=r("./src/util/extend.js");Object.defineProperty(t,"extend",{enumerable:true,get:function e(){return p(u).default}});var l=r("./src/util/style.js");Object.defineProperty(t,"style",{enumerable:true,get:function e(){return p(l).default}});var c=r("./src/util/request-animation-frame.js");Object.defineProperty(t,"requestAnimationFrame",{enumerable:true,get:function e(){return p(c).default}});var f=r("./src/util/frame.js");Object.defineProperty(t,"frame",{enumerable:true,get:function e(){return p(f).default}});var h=r("./node_modules/debounce/index.js");Object.defineProperty(t,"debounce",{enumerable:true,get:function e(){return p(h).default}});var d=r("./src/util/prevent-click.js");Object.defineProperty(t,"preventClick",{enumerable:true,get:function e(){return p(d).default}});function p(e){return e&&e.__esModule?e:{default:e}}},"./src/util/max.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=i;function i(e){var t=-Infinity;Object.keys(e).forEach(function(r){if(e[r]>t){t=e[r]}});return t}e.exports=t["default"]},"./src/util/min.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=i;function i(e){var t=Number(Infinity);Object.keys(e).forEach(function(r){if(e[r]<t){t=e[r]}});return t}e.exports=t["default"]},"./src/util/observer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function e(){a(this,e);this.handlers=null}i(e,[{key:"on",value:function e(t,r){var i=this;if(!this.handlers){this.handlers={}}var a=this.handlers[t];if(!a){a=this.handlers[t]=[]}a.push(r);return{name:t,callback:r,un:function e(t,r){return i.un(t,r)}}}},{key:"un",value:function e(t,r){if(!this.handlers){return}var i=this.handlers[t];var a=void 0;if(i){if(r){for(a=i.length-1;a>=0;a--){if(i[a]==r){i.splice(a,1)}}}else{i.length=0}}}},{key:"unAll",value:function e(){this.handlers=null}},{key:"once",value:function e(t,r){var i=this;var a=function e(){for(var a=arguments.length,n=Array(a),s=0;s<a;s++){n[s]=arguments[s]}r.apply(i,n);setTimeout(function(){i.un(t,e)},0)};return this.on(t,a)}},{key:"fireEvent",value:function e(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}if(!this.handlers){return}var n=this.handlers[t];n&&n.forEach(function(e){e.apply(undefined,i)})}}]);return e}();t.default=n;e.exports=t["default"]},"./src/util/prevent-click.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=a;function i(e){e.stopPropagation();document.body.removeEventListener("click",i,true)}function a(e){document.body.addEventListener("click",i,true)}e.exports=t["default"]},"./src/util/request-animation-frame.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return setTimeout(e,1e3/60)}).bind(window);e.exports=t["default"]},"./src/util/style.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=i;function i(e,t){Object.keys(t).forEach(function(r){if(e.style[r]!==t[r]){e.style[r]=t[r]}});return e}e.exports=t["default"]},"./src/wavesurfer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=r("./src/util/index.js");var n=v(a);var s=r("./src/drawer.multicanvas.js");var o=p(s);var u=r("./src/webaudio.js");var l=p(u);var c=r("./src/mediaelement.js");var f=p(c);var h=r("./src/peakcache.js");var d=p(h);function p(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function k(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var g=function(){i(e,[{key:"create",value:function e(t){}}]);function e(t,r){k(this,e)}i(e,[{key:"init",value:function e(){}},{key:"destroy",value:function e(){}}]);return e}();var b=function(e){m(t,e);i(t,null,[{key:"create",value:function e(r){var i=new t(r);return i.init()}}]);function t(e){var r;k(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.defaultParams={audioContext:null,audioRate:1,autoCenter:true,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:true,fillParent:true,forceDecode:false,height:128,hideScrollbar:false,interact:true,loopSelection:true,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:false,mediaType:"audio",minPxPerSec:20,normalize:false,partialRender:false,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:true,renderer:o.default,responsive:false,scrollParent:false,skipLength:2,splitChannels:false,waveColor:"#999",xhr:{}};i.backends={MediaElement:f.default,WebAudio:l.default};i.util=n;i.params=n.extend({},i.defaultParams,e);i.container="string"==typeof e.container?document.querySelector(i.params.container):i.params.container;if(!i.container){throw new Error("Container element not found")}if(i.params.mediaContainer==null){i.mediaContainer=i.container}else if(typeof i.params.mediaContainer=="string"){i.mediaContainer=document.querySelector(i.params.mediaContainer)}else{i.mediaContainer=i.params.mediaContainer}if(!i.mediaContainer){throw new Error("Media Container element not found")}if(i.params.maxCanvasWidth<=1){throw new Error("maxCanvasWidth must be greater than 1")}else if(i.params.maxCanvasWidth%2==1){throw new Error("maxCanvasWidth must be an even number")}i.savedVolume=0;i.isMuted=false;i.tmpEvents=[];i.currentAjax=null;i.arraybuffer=null;i.drawer=null;i.backend=null;i.peakCache=null;if(typeof i.params.renderer!=="function"){throw new Error("Renderer parameter is invalid")}i.Drawer=i.params.renderer;i.Backend=i.backends[i.params.backend];i.initialisedPluginList={};i.isDestroyed=false;i.isReady=false;var a=0;i._onResize=n.debounce(function(){if(a!=i.drawer.wrapper.clientWidth&&!i.params.scrollParent){a=i.drawer.wrapper.clientWidth;i.drawer.fireEvent("redraw")}},typeof i.params.responsive==="number"?i.params.responsive:100);return r=i,y(i,r)}i(t,[{key:"init",value:function e(){this.registerPlugins(this.params.plugins);this.createDrawer();this.createBackend();this.createPeakCache();return this}},{key:"registerPlugins",value:function e(t){var r=this;t.forEach(function(e){return r.addPlugin(e)});t.forEach(function(e){if(!e.deferInit){r.initPlugin(e.name)}});this.fireEvent("plugins-registered",t);return this}},{key:"addPlugin",value:function e(t){var r=this;if(!t.name){throw new Error("Plugin does not have a name!")}if(!t.instance){throw new Error("Plugin "+t.name+" does not have an instance property!")}if(t.staticProps){Object.keys(t.staticProps).forEach(function(e){r[e]=t.staticProps[e]})}var i=t.instance;var a=Object.getOwnPropertyNames(n.Observer.prototype);a.forEach(function(e){i.prototype[e]=n.Observer.prototype[e]});this[t.name]=new i(t.params||{},this)
;this.fireEvent("plugin-added",t.name);return this}},{key:"initPlugin",value:function e(t){if(!this[t]){throw new Error("Plugin "+t+" has not been added yet!")}if(this.initialisedPluginList[t]){this.destroyPlugin(t)}this[t].init();this.initialisedPluginList[t]=true;this.fireEvent("plugin-initialised",t);return this}},{key:"destroyPlugin",value:function e(t){if(!this[t]){throw new Error("Plugin "+t+" has not been added yet and cannot be destroyed!")}if(!this.initialisedPluginList[t]){throw new Error("Plugin "+t+" is not active and cannot be destroyed!")}if(typeof this[t].destroy!=="function"){throw new Error("Plugin "+t+" does not have a destroy function!")}this[t].destroy();delete this.initialisedPluginList[t];this.fireEvent("plugin-destroyed",t);return this}},{key:"destroyAllPlugins",value:function e(){var t=this;Object.keys(this.initialisedPluginList).forEach(function(e){return t.destroyPlugin(e)})}},{key:"createDrawer",value:function e(){var t=this;this.drawer=new this.Drawer(this.container,this.params);this.drawer.init();this.fireEvent("drawer-created",this.drawer);if(this.params.responsive!==false){window.addEventListener("resize",this._onResize,true);window.addEventListener("orientationchange",this._onResize,true)}this.drawer.on("redraw",function(){t.drawBuffer();t.drawer.progress(t.backend.getPlayedPercents())});this.drawer.on("click",function(e,r){setTimeout(function(){return t.seekTo(r)},0)});this.drawer.on("scroll",function(e){if(t.params.partialRender){t.drawBuffer()}t.fireEvent("scroll",e)})}},{key:"createBackend",value:function e(){var t=this;if(this.backend){this.backend.destroy()}if(this.params.backend=="AudioElement"){this.params.backend="MediaElement"}if(this.params.backend=="WebAudio"&&!this.Backend.prototype.supportsWebAudio.call(null)){this.params.backend="MediaElement"}this.backend=new this.Backend(this.params);this.backend.init();this.fireEvent("backend-created",this.backend);this.backend.on("finish",function(){return t.fireEvent("finish")});this.backend.on("play",function(){return t.fireEvent("play")});this.backend.on("pause",function(){return t.fireEvent("pause")});this.backend.on("audioprocess",function(e){t.drawer.progress(t.backend.getPlayedPercents());t.fireEvent("audioprocess",e)})}},{key:"createPeakCache",value:function e(){if(this.params.partialRender){this.peakCache=new d.default}}},{key:"getDuration",value:function e(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function e(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function e(t){if(t>=this.getDuration()){this.seekTo(1)}else{this.seekTo(t/this.getDuration())}}},{key:"play",value:function e(t,r){var i=this;this.fireEvent("interaction",function(){return i.play(t,r)});return this.backend.play(t,r)}},{key:"pause",value:function e(){if(!this.backend.isPaused()){return this.backend.pause()}}},{key:"playPause",value:function e(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function e(){return!this.backend.isPaused()}},{key:"skipBackward",value:function e(t){this.skip(-t||-this.params.skipLength)}},{key:"skipForward",value:function e(t){this.skip(t||this.params.skipLength)}},{key:"skip",value:function e(t){var r=this.getDuration()||1;var i=this.getCurrentTime()||0;i=Math.max(0,Math.min(r,i+(t||0)));this.seekAndCenter(i/r)}},{key:"seekAndCenter",value:function e(t){this.seekTo(t);this.drawer.recenter(t)}},{key:"seekTo",value:function e(t){var r=this;if(typeof t!=="number"||!isFinite(t)||t<0||t>1){return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!")}this.fireEvent("interaction",function(){return r.seekTo(t)});var i=this.backend.isPaused();if(!i){this.backend.pause()}var a=this.params.scrollParent;this.params.scrollParent=false;this.backend.seekTo(t*this.getDuration());this.drawer.progress(t);if(!i){this.backend.play()}this.params.scrollParent=a;this.fireEvent("seek",t)}},{key:"stop",value:function e(){this.pause();this.seekTo(0);this.drawer.progress(0)}},{key:"setSinkId",value:function e(t){return this.backend.setSinkId(t)}},{key:"setVolume",value:function e(t){this.backend.setVolume(t);this.fireEvent("volume",t)}},{key:"getVolume",value:function e(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function e(t){this.backend.setPlaybackRate(t)}},{key:"getPlaybackRate",value:function e(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function e(){this.setMute(!this.isMuted)}},{key:"setMute",value:function e(t){if(t===this.isMuted){this.fireEvent("mute",this.isMuted);return}if(t){this.savedVolume=this.backend.getVolume();this.backend.setVolume(0);this.isMuted=true;this.fireEvent("volume",0)}else{this.backend.setVolume(this.savedVolume);this.isMuted=false;this.fireEvent("volume",this.savedVolume)}this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function e(){return this.isMuted}},{key:"isReady",value:function e(){return this.isReady}},{key:"getFilters",value:function e(){return this.backend.filters||[]}},{key:"toggleScroll",value:function e(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()}},{key:"toggleInteraction",value:function e(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function e(){return this.params.waveColor}},{key:"setWaveColor",value:function e(t){this.params.waveColor=t;this.drawBuffer()}},{key:"getProgressColor",value:function e(){return this.params.progressColor}},{key:"setProgressColor",value:function e(t){this.params.progressColor=t;this.drawBuffer()}},{key:"getCursorColor",value:function e(){return this.params.cursorColor}},{key:"setCursorColor",value:function e(t){this.params.cursorColor=t;this.drawer.updateCursor()}},{key:"getHeight",value:function e(){return this.params.height}},{key:"setHeight",value:function e(t){this.params.height=t;this.drawer.setHeight(t*this.params.pixelRatio);this.drawBuffer()}},{key:"drawBuffer",value:function e(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);var r=this.drawer.getWidth();var i=t;var a=this.drawer.getScrollX();var n=Math.max(a+r,i);if(this.params.fillParent&&(!this.params.scrollParent||t<r)){i=r;a=0;n=i}var s=void 0;if(this.params.partialRender){var o=this.peakCache.addRangeToPeakCache(i,a,n);var u=void 0;for(u=0;u<o.length;u++){s=this.backend.getPeaks(i,o[u][0],o[u][1]);this.drawer.drawPeaks(s,i,o[u][0],o[u][1])}}else{s=this.backend.getPeaks(i,a,n);this.drawer.drawPeaks(s,i,a,n)}this.fireEvent("redraw",s,i)}},{key:"zoom",value:function e(t){if(!t){this.params.minPxPerSec=this.defaultParams.minPxPerSec;this.params.scrollParent=false}else{this.params.minPxPerSec=t;this.params.scrollParent=true}this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",t)}},{key:"loadArrayBuffer",value:function e(t){var r=this;this.decodeArrayBuffer(t,function(e){if(!r.isDestroyed){r.loadDecodedBuffer(e)}})}},{key:"loadDecodedBuffer",value:function e(t){this.backend.load(t);this.drawBuffer();this.fireEvent("ready");this.isReady=true}},{key:"loadBlob",value:function e(t){var r=this;var i=new FileReader;i.addEventListener("progress",function(e){return r.onProgress(e)});i.addEventListener("load",function(e){return r.loadArrayBuffer(e.target.result)});i.addEventListener("error",function(){return r.fireEvent("error","Error reading file")});i.readAsArrayBuffer(t);this.empty()}},{key:"load",value:function e(t,r,i,a){this.empty();if(i){var n={"Preload is not 'auto', 'none' or 'metadata'":["auto","metadata","none"].indexOf(i)===-1,"Peaks are not provided":!r,"Backend is not of type MediaElement":this.params.backend!=="MediaElement","Url is not of type string":typeof t!=="string"};var s=Object.keys(n).filter(function(e){return n[e]});if(s.length){console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+s.join("\n\t- "));i=null}}switch(this.params.backend){case"WebAudio":return this.loadBuffer(t,r,a);case"MediaElement":return this.loadMediaElement(t,r,i,a)}}},{key:"loadBuffer",value:function e(t,r,i){var a=this;var n=function e(r){if(r){a.tmpEvents.push(a.once("ready",r))}return a.getArrayBuffer(t,function(e){return a.loadArrayBuffer(e)})};if(r){this.backend.setPeaks(r,i);this.drawBuffer();this.tmpEvents.push(this.once("interaction",n))}else{return n()}}},{key:"loadMediaElement",value:function e(t,r,i,a){var n=this;var s=t;if(typeof t==="string"){this.backend.load(s,this.mediaContainer,r,i)}else{var o=t;this.backend.loadElt(o,r);s=o.src}this.tmpEvents.push(this.backend.once("canplay",function(){n.drawBuffer();n.fireEvent("ready");n.isReady=true}),this.backend.once("error",function(e){return n.fireEvent("error",e)}));if(r){this.backend.setPeaks(r,a)}if((!r||this.params.forceDecode)&&this.backend.supportsWebAudio()){this.getArrayBuffer(s,function(e){n.decodeArrayBuffer(e,function(e){n.backend.buffer=e;n.backend.setPeaks(null);n.drawBuffer();n.fireEvent("waveform-ready")})})}}},{key:"decodeArrayBuffer",value:function e(t,r){var i=this;this.arraybuffer=t;this.backend.decodeArrayBuffer(t,function(e){if(!i.isDestroyed&&i.arraybuffer==t){r(e);i.arraybuffer=null}},function(){return i.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function e(t,r){var i=this;var a=n.ajax({url:t,responseType:"arraybuffer",xhr:this.params.xhr});this.currentAjax=a;this.tmpEvents.push(a.on("progress",function(e){i.onProgress(e)}),a.on("success",function(e,t){r(e);i.currentAjax=null}),a.on("error",function(e){i.fireEvent("error","XHR error: "+e.target.statusText);i.currentAjax=null}));return a}},{key:"onProgress",value:function e(t){var r=void 0;if(t.lengthComputable){r=t.loaded/t.total}else{r=t.loaded/(t.loaded+1e6)}this.fireEvent("loading",Math.round(r*100),t.target)}},{key:"exportPCM",value:function e(t,r,i,a){t=t||1024;a=a||0;r=r||1e4;i=i||false;var n=this.backend.getPeaks(t,a);var s=[].map.call(n,function(e){return Math.round(e*r)/r});var o=JSON.stringify(s);if(!i){window.open("data:application/json;charset=utf-8,"+encodeURIComponent(o))}return o}},{key:"exportImage",value:function e(t,r){if(!t){t="image/png"}if(!r){r=1}return this.drawer.getImage(t,r)}},{key:"cancelAjax",value:function e(){if(this.currentAjax){this.currentAjax.xhr.abort();this.currentAjax=null}}},{key:"clearTmpEvents",value:function e(){this.tmpEvents.forEach(function(e){return e.un()})}},{key:"empty",value:function e(){if(!this.backend.isPaused()){this.stop();this.backend.disconnectSource()}this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function e(){this.destroyAllPlugins();this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();if(this.params.responsive!==false){window.removeEventListener("resize",this._onResize,true);window.removeEventListener("orientationchange",this._onResize,true)}this.backend.destroy();this.drawer.destroy();this.isDestroyed=true;this.arraybuffer=null}}]);return t}(n.Observer);b.util=n;t.default=b;e.exports=t["default"]},"./src/webaudio.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,r,i){if(r)e(t.prototype,r);if(i)e(t,i);return t}}();var a=r("./src/util/index.js");var n=s(a);function s(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function o(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f="playing";var h="paused";var d="finished";var p=function(e){c(t,e);i(t,[{key:"supportsWebAudio",value:function e(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function e(){if(!window.WaveSurferAudioContext){window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)}return window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function e(t){if(!window.WaveSurferOfflineAudioContext){window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,t)}return window.WaveSurferOfflineAudioContext}}]);function t(e){var r,i;u(this,t);var a=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));a.audioContext=null;a.offlineAudioContext=null;a.stateBehaviors=(r={},o(r,f,{init:function e(){this.addOnAudioProcess()},getPlayedPercents:function e(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function e(){return this.startPosition+this.getPlayedTime()}}),o(r,h,{init:function e(){this.removeOnAudioProcess()},getPlayedPercents:function e(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function e(){return this.startPosition}}),o(r,d,{init:function e(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function e(){return 1},getCurrentTime:function e(){return this.getDuration()}}),r);a.params=e;a.ac=e.audioContext||a.getAudioContext();a.lastPlay=a.ac.currentTime;a.startPosition=0;a.scheduledPause=null;a.states=(i={},o(i,f,Object.create(a.stateBehaviors[f])),o(i,h,Object.create(a.stateBehaviors[h])),o(i,d,Object.create(a.stateBehaviors[d])),i);a.analyser=null;a.buffer=null;a.filters=[];a.gainNode=null;a.mergedPeaks=null;a.offlineAc=null;a.peaks=null;a.playbackRate=1;a.analyser=null;a.scriptNode=null;a.source=null;a.splitPeaks=[];a.state=null;a.explicitDuration=null;return a}i(t,[{key:"init",value:function e(){this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(h);this.setPlaybackRate(this.params.audioRate);this.setLength(0)}},{key:"disconnectFilters",value:function e(){if(this.filters){this.filters.forEach(function(e){e&&e.disconnect()});this.filters=null;this.analyser.connect(this.gainNode)}}},{key:"setState",value:function e(t){if(this.state!==this.states[t]){this.state=this.states[t];this.state.init.call(this)}}},{key:"setFilter",value:function e(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++){r[i]=arguments[i]}this.setFilters(r)}},{key:"setFilters",value:function e(t){this.disconnectFilters();if(t&&t.length){this.filters=t;this.analyser.disconnect();t.reduce(function(e,t){e.connect(t);return t},this.analyser).connect(this.gainNode)}}},{key:"createScriptNode",value:function e(){if(this.params.audioScriptProcessor){this.scriptNode=this.params.audioScriptProcessor}else{if(this.ac.createScriptProcessor){this.scriptNode=this.ac.createScriptProcessor(t.scriptBufferSize)}else{this.scriptNode=this.ac.createJavaScriptNode(t.scriptBufferSize)}}this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function e(){var t=this;this.scriptNode.onaudioprocess=function(){var e=t.getCurrentTime();if(e>=t.getDuration()){t.setState(d);t.fireEvent("pause")}else if(e>=t.scheduledPause){t.pause()}else if(t.state===t.states[f]){t.fireEvent("audioprocess",e)}}}},{key:"removeOnAudioProcess",value:function e(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function e(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function e(){if(this.ac.createGain){this.gainNode=this.ac.createGain()}else{this.gainNode=this.ac.createGainNode()}this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function e(t){if(t){var r=new window.Audio;if(!r.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}r.autoplay=true;var i=this.ac.createMediaStreamDestination();this.gainNode.disconnect();this.gainNode.connect(i);r.src=URL.createObjectURL(i.stream);return r.setSinkId(t)}else{return Promise.reject(new Error("Invalid deviceId: "+t))}}},{key:"setVolume",value:function e(t){this.gainNode.gain.setValueAtTime(t,this.ac.currentTime)}},{key:"getVolume",value:function e(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function e(t,r,i){if(!this.offlineAc){this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)}this.offlineAc.decodeAudioData(t,function(e){return r(e)},i)}},{key:"setPeaks",value:function e(t,r){this.explicitDuration=r;this.peaks=t}},{key:"setLength",value:function e(t){if(this.mergedPeaks&&t==2*this.mergedPeaks.length-1+2){return}this.splitPeaks=[];this.mergedPeaks=[];var r=this.buffer?this.buffer.numberOfChannels:1;var i=void 0;for(i=0;i<r;i++){this.splitPeaks[i]=[];this.splitPeaks[i][2*(t-1)]=0;this.splitPeaks[i][2*(t-1)+1]=0}this.mergedPeaks[2*(t-1)]=0;this.mergedPeaks[2*(t-1)+1]=0}},{key:"getPeaks",value:function e(t,r,i){if(this.peaks){return this.peaks}r=r||0;i=i||t-1;this.setLength(t);if(!this.buffer.length){var a=this.createBuffer(1,4096,this.sampleRate);this.buffer=a.buffer}var n=this.buffer.length/t;var s=~~(n/10)||1;var o=this.buffer.numberOfChannels;var u=void 0;for(u=0;u<o;u++){var l=this.splitPeaks[u];var c=this.buffer.getChannelData(u);var f=void 0;for(f=r;f<=i;f++){var h=~~(f*n);var d=~~(h+n);var p=0;var v=0;var y=void 0;for(y=h;y<d;y+=s){var m=c[y];if(m>v){v=m}if(m<p){p=m}}l[2*f]=v;l[2*f+1]=p;if(u==0||v>this.mergedPeaks[2*f]){this.mergedPeaks[2*f]=v}if(u==0||p<this.mergedPeaks[2*f+1]){this.mergedPeaks[2*f+1]=p}}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function e(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function e(){if(this.source){this.source.disconnect()}}},{key:"destroy",value:function e(){if(!this.isPaused()){this.pause()}this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();if(this.params.closeAudioContext){if(typeof this.ac.close==="function"&&this.ac.state!="closed"){this.ac.close()}this.ac=null;if(!this.params.audioContext){window.WaveSurferAudioContext=null}else{this.params.audioContext=null}window.WaveSurferOfflineAudioContext=null}}},{key:"load",value:function e(t){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=t;this.createSource()}},{key:"createSource",value:function e(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime);this.source.buffer=this.buffer;this.source.connect(this.analyser)}},{key:"isPaused",value:function e(){return this.state!==this.states[f]}},{key:"getDuration",value:function e(){if(!this.buffer){if(this.explicitDuration){return this.explicitDuration}return 0}return this.buffer.duration}},{key:"seekTo",value:function e(t,r){if(!this.buffer){return}this.scheduledPause=null;if(t==null){t=this.getCurrentTime();if(t>=this.getDuration()){t=0}}if(r==null){r=this.getDuration()}this.startPosition=t;this.lastPlay=this.ac.currentTime;if(this.state===this.states[d]){this.setState(h)}return{start:t,end:r}}},{key:"getPlayedTime",value:function e(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function e(t,r){if(!this.buffer){return}this.createSource();var i=this.seekTo(t,r);t=i.start;r=i.end;this.scheduledPause=r;this.source.start(0,t,r-t);if(this.ac.state=="suspended"){this.ac.resume&&this.ac.resume()}this.setState(f);this.fireEvent("play")}},{key:"pause",value:function e(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(h);this.fireEvent("pause")}},{key:"getCurrentTime",value:function e(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function e(){return this.playbackRate}},{key:"setPlaybackRate",value:function e(t){t=t||1;if(this.isPaused()){this.playbackRate=t}else{this.pause();this.playbackRate=t;this.play()}}}]);return t}(n.Observer);p.scriptBufferSize=256;t.default=p;e.exports=t["default"]}})});