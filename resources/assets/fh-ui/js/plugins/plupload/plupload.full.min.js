var MXI_DEBUG=true;(function(e,t){var i=function(){var e={};t.apply(e,arguments);return e.moxie};if(typeof define==="function"&&define.amd){e.moxie=i();define("moxie",[],i)}else if(typeof module==="object"&&module.exports){module.exports=i()}else{e.moxie=i()}})(this||window,function(){(function(e,t){"use strict";var i={};function n(e,t){var n,r=[];for(var o=0;o<e.length;++o){n=i[e[o]]||s(e[o]);if(!n){throw"module definition dependecy not found: "+e[o]}r.push(n)}t.apply(null,r)}function r(e,r,o){if(typeof e!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(r===t){throw"invalid module definition, dependencies must be specified"}if(o===t){throw"invalid module definition, definition function must be specified"}n(r,function(){i[e]=o.apply(null,arguments)})}function o(e){return!!i[e]}function s(t){var i=e;var n=t.split(/[.\/]/);for(var r=0;r<n.length;++r){if(!i[n[r]]){return}i=i[n[r]]}return i}function a(n){for(var r=0;r<n.length;r++){var o=e;var s=n[r];var a=s.split(/[.\/]/);for(var u=0;u<a.length-1;++u){if(o[a[u]]===t){o[a[u]]={}}o=o[a[u]]}o[a[a.length-1]]=i[s]}}r("moxie/core/utils/Basic",[],function(){function e(e){var t;if(e===t){return"undefined"}else if(e===null){return"null"}else if(e.nodeType){return"node"}return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function t(){return a(false,false,arguments)}function i(){return a(true,false,arguments)}function n(){return a(false,true,arguments)}function r(){return a(true,true,arguments)}function o(t){switch(e(t)){case"array":return a(false,true,[[],t]);case"object":return a(false,true,[{},t]);default:return t}}function s(i){switch(e(i)){case"array":return Array.prototype.slice.call(i);case"object":return t({},i)}return i}function a(t,i,n){var r;var o=n[0];l(n,function(n,u){if(u>0){l(n,function(n,u){var l=m(e(n),["array","object"])!==-1;if(n===r||t&&o[u]===r){return true}if(l&&i){n=s(n)}if(e(o[u])===e(n)&&l){a(t,i,[o[u],n])}else{o[u]=n}})}});return o}function u(e,t){for(var i in t){if({}.hasOwnProperty.call(t,i)){e[i]=t[i]}}function n(){this.constructor=e;if(MXI_DEBUG){var t=function(e){var t=e.toString().match(/^function\s([^\(\s]+)/);return t?t[1]:false};this.ctorName=t(e)}}n.prototype=t.prototype;e.prototype=new n;e.parent=t.prototype;return e}function l(e,t){var i,n,r,o;if(e){try{i=e.length}catch(e){i=o}if(i===o||typeof i!=="number"){for(n in e){if(e.hasOwnProperty(n)){if(t(e[n],n)===false){return}}}}else{for(r=0;r<i;r++){if(t(e[r],r)===false){return}}}}}function c(t){var i;if(!t||e(t)!=="object"){return true}for(i in t){return false}return true}function f(t,i){var n=0,r=t.length;if(e(i)!=="function"){i=function(){}}if(!t||!t.length){i()}function o(n){if(e(t[n])==="function"){t[n](function(e){++n<r&&!e?o(n):i(e)})}}o(n)}function d(e,t){var i=0,n=e.length,r=new Array(n);l(e,function(e,o){e(function(e){if(e){return t(e)}var s=[].slice.call(arguments);s.shift();r[o]=s;i++;if(i===n){r.unshift(null);t.apply(this,r)}})})}function m(e,t){if(t){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(t,e)}for(var i=0,n=t.length;i<n;i++){if(t[i]===e){return i}}}return-1}function h(t,i){var n=[];if(e(t)!=="array"){t=[t]}if(e(i)!=="array"){i=[i]}for(var r in t){if(m(t[r],i)===-1){n.push(t[r])}}return n.length?n:false}function p(e,t){var i=[];l(e,function(e){if(m(e,t)!==-1){i.push(e)}});return i.length?i:null}function g(e){var t,i=[];for(t=0;t<e.length;t++){i[t]=e[t]}return i}var v=function(){var e=0;return function(t){var i=(new Date).getTime().toString(32),n;for(n=0;n<5;n++){i+=Math.floor(Math.random()*65535).toString(32)}return(t||"o_")+i+(e++).toString(32)}}();function x(e){if(!e){return e}return String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,"")}function y(e){if(typeof e!=="string"){return e}var t={t:1099511627776,g:1073741824,m:1048576,k:1024},i;e=/^([0-9\.]+)([tmgk]?)$/.exec(e.toLowerCase().replace(/[^0-9\.tmkg]/g,""));i=e[2];e=+e[1];if(t.hasOwnProperty(i)){e*=t[i]}return Math.floor(e)}function w(e){var t=[].slice.call(arguments,1);return e.replace(/%([a-z])/g,function(e,i){var n=t.shift();switch(i){case"s":return n+"";case"d":return parseInt(n,10);case"f":return parseFloat(n);case"c":return"";default:return n}})}function _(e,t){var i=this;setTimeout(function(){e.call(i)},t||1)}return{guid:v,typeOf:e,extend:t,extendIf:i,extendImmutable:n,extendImmutableIf:r,clone:o,inherit:u,each:l,isEmptyObj:c,inSeries:f,inParallel:d,inArray:m,arrayDiff:h,arrayIntersect:p,toArray:g,trim:x,sprintf:w,parseSizeStr:y,delay:_}});r("moxie/core/utils/Encode",[],function(){var e=function(e){return unescape(encodeURIComponent(e))};var t=function(e){return decodeURIComponent(escape(e))};var i=function(e,i){if(typeof window.atob==="function"){return i?t(window.atob(e)):window.atob(e)}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var r,o,s,a,u,l,c,f,d=0,m=0,h="",p=[];if(!e){return e}e+="";do{a=n.indexOf(e.charAt(d++));u=n.indexOf(e.charAt(d++));l=n.indexOf(e.charAt(d++));c=n.indexOf(e.charAt(d++));f=a<<18|u<<12|l<<6|c;r=f>>16&255;o=f>>8&255;s=f&255;if(l==64){p[m++]=String.fromCharCode(r)}else if(c==64){p[m++]=String.fromCharCode(r,o)}else{p[m++]=String.fromCharCode(r,o,s)}}while(d<e.length);h=p.join("");return i?t(h):h};var n=function(t,i){if(i){t=e(t)}if(typeof window.btoa==="function"){return window.btoa(t)}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var r,o,s,a,u,l,c,f,d=0,m=0,h="",p=[];if(!t){return t}do{r=t.charCodeAt(d++);o=t.charCodeAt(d++);s=t.charCodeAt(d++);f=r<<16|o<<8|s;a=f>>18&63;u=f>>12&63;l=f>>6&63;c=f&63;p[m++]=n.charAt(a)+n.charAt(u)+n.charAt(l)+n.charAt(c)}while(d<t.length);h=p.join("");var g=t.length%3;return(g?h.slice(0,g-3):h)+"===".slice(g||3)};return{utf8_encode:e,utf8_decode:t,atob:i,btoa:n}});r("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(e){var i=function(e){var t="",i="?",n="function",r="undefined",o="object",s="major",a="model",u="name",l="type",c="vendor",f="version",d="architecture",m="console",h="mobile",p="tablet";var g={has:function(e,t){return t.toLowerCase().indexOf(e.toLowerCase())!==-1},lowerize:function(e){return e.toLowerCase()}};var v={rgx:function(){for(var t,i=0,s,a,u,l,c,f,d=arguments;i<d.length;i+=2){var m=d[i],h=d[i+1];if(typeof t===r){t={};for(u in h){l=h[u];if(typeof l===o){t[l[0]]=e}else{t[l]=e}}}for(s=a=0;s<m.length;s++){c=m[s].exec(this.getUA());if(!!c){for(u=0;u<h.length;u++){f=c[++a];l=h[u];if(typeof l===o&&l.length>0){if(l.length==2){if(typeof l[1]==n){t[l[0]]=l[1].call(this,f)}else{t[l[0]]=l[1]}}else if(l.length==3){if(typeof l[1]===n&&!(l[1].exec&&l[1].test)){t[l[0]]=f?l[1].call(this,f,l[2]):e}else{t[l[0]]=f?f.replace(l[1],l[2]):e}}else if(l.length==4){t[l[0]]=f?l[3].call(this,f.replace(l[1],l[2])):e}}else{t[l]=f?f:e}}break}}if(!!c)break}return t},str:function(t,n){for(var r in n){if(typeof n[r]===o&&n[r].length>0){for(var s=0;s<n[r].length;s++){if(g.has(n[r][s],t)){return r===i?e:r}}}else if(g.has(n[r],t)){return r===i?e:r}}return t}};var x={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}};var y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[u,f],[/\s(opr)\/([\w\.]+)/i],[[u,"Opera"],f],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[u,f],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[u,"IE"],f],[/(edge)\/((\d+)?[\w\.]+)/i],[u,f],[/(yabrowser)\/([\w\.]+)/i],[[u,"Yandex"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],f],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[u,f],[/(dolfin)\/([\w\.]+)/i],[[u,"Dolphin"],f],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[u,"Chrome"],f],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[f,[u,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[f,[u,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[f,[u,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[f,[u,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[f,u],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[u,[f,v.str,x.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape)\/([\w\.-]+)/i],[[u,"Netscape"],f],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[u,f]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[f,[u,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,f],[/rv\:([\w\.]+).*(gecko)/i],[f,u]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[u,f],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[f,v.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,"Windows"],[f,v.str,x.os.windows.version]],[/\((bb)(10);/i],[[u,"BlackBerry"],f],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[u,f],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[u,"Symbian"],f],[/\((series40);/i],[u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,"Firefox OS"],f],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[u,f],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,"Chromium OS"],f],[/(sunos)\s?([\w\.]+\d)*/i],[[u,"Solaris"],f],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[u,f],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[u,"iOS"],[f,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[u,"Mac OS"],[f,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[u,f]]};var w=function(e){var i=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:t);this.getBrowser=function(){return v.rgx.apply(this,y.browser)};this.getEngine=function(){return v.rgx.apply(this,y.engine)};this.getOS=function(){return v.rgx.apply(this,y.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return i};this.setUA=function(e){i=e;return this};this.setUA(i)};return w}();function n(e,t,i){var n=0,r=0,o=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},a=function(e){e=(""+e).replace(/[_\-+]/g,".");e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return!e.length?[-8]:e.split(".")},u=function(e){return!e?0:isNaN(e)?s[e]||-7:parseInt(e,10)};e=a(e);t=a(t);r=Math.max(e.length,t.length);for(n=0;n<r;n++){if(e[n]==t[n]){continue}e[n]=u(e[n]);t[n]=u(t[n]);if(e[n]<t[n]){o=-1;break}else if(e[n]>t[n]){o=1;break}}if(!i){return o}switch(i){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return o<=0;case"==":case"=":case"eq":return o===0;case"<>":case"!=":case"ne":return o!==0;case"":case"<":case"lt":return o<0;default:return null}}var r=function(){var i={access_global_ns:function(){return!!window.moxie},define_property:function(){return false}(),create_canvas:function(){var e=document.createElement("canvas");var t=!!(e.getContext&&e.getContext("2d"));i.create_canvas=t;return t},return_response_type:function(t){try{if(e.inArray(t,["","text","document"])!==-1){return true}else if(window.XMLHttpRequest){var i=new XMLHttpRequest;i.open("get","/");if("responseType"in i){i.responseType=t;if(i.responseType!==t){return false}return true}}}catch(e){}return false},use_blob_uri:function(){var e=window.URL;i.use_blob_uri=e&&"createObjectURL"in e&&"revokeObjectURL"in e&&(s.browser!=="IE"||s.verComp(s.version,"11.0.46",">="));return i.use_blob_uri},use_data_uri:function(){var e=new Image;e.onload=function(){i.use_data_uri=e.width===1&&e.height===1};setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return false}(),use_data_uri_over32kb:function(){return i.use_data_uri&&(s.browser!=="IE"||s.version>=9)},use_data_uri_of:function(e){return i.use_data_uri&&e<33e3||i.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)){return false}var e=document.createElement("input");e.setAttribute("type","file");return i.use_fileinput=!e.disabled},use_webgl:function(){var e=document.createElement("canvas");var n=null,r;try{n=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}if(!n){n=null}r=!!n;i.use_webgl=r;e=t;return r}};return function(t){var n=[].slice.call(arguments);n.shift();return e.typeOf(i[t])==="function"?i[t].apply(this,n):!!i[t]}}();var o=(new i).getResult();var s={can:r,uaParser:i,browser:o.browser.name,version:o.browser.version,os:o.os.name,osVersion:o.os.version,verComp:n,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};s.OS=s.os;if(MXI_DEBUG){s.debug={runtime:true,events:false};s.log=function(){function t(e){i.appendChild(document.createTextNode(e+"\n"))}if(window&&window.console&&window.console.log&&window.console.log.apply){window.console.log.apply(window.console,arguments)}else if(document){var i=document.getElementById("moxie-console");if(!i){i=document.createElement("pre");i.id="moxie-console";document.body.appendChild(i)}var n=arguments[0];if(e.typeOf(n)==="string"){n=e.sprintf.apply(this,arguments)}else if(e.inArray(e.typeOf(n),["object","array"])!==-1){t(n);return}i.appendChild(document.createTextNode(n+"\n"))}}}return s});r("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(e){function t(e,t){var i;for(i in e){if(e[i]===t){return i}}return null}return{RuntimeError:function(){var i={NOT_INIT_ERR:1,EXCEPTION_ERR:3,NOT_SUPPORTED_ERR:9,JS_ERR:4};function n(e,n){this.code=e;this.name=t(i,e);this.message=this.name+(n||": RuntimeError "+this.code)}e.extend(n,i);n.prototype=Error.prototype;return n}(),OperationNotAllowedException:function(){function t(e){this.code=e;this.name="OperationNotAllowedException"}e.extend(t,{NOT_ALLOWED_ERR:1});t.prototype=Error.prototype;return t}(),ImageError:function(){var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};function n(e){this.code=e;this.name=t(i,e);this.message=this.name+": ImageError "+this.code}e.extend(n,i);n.prototype=Error.prototype;return n}(),FileException:function(){var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function n(e){this.code=e;this.name=t(i,e);this.message=this.name+": FileException "+this.code}e.extend(n,i);n.prototype=Error.prototype;return n}(),DOMException:function(){var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function n(e){this.code=e;this.name=t(i,e);this.message=this.name+": DOMException "+this.code}e.extend(n,i);n.prototype=Error.prototype;return n}(),EventException:function(){function t(e){this.code=e;this.name="EventException"}e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0});t.prototype=Error.prototype;return t}()}});r("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(e){var t=function(e){if(typeof e!=="string"){return e}return document.getElementById(e)};var i=function(e,t){if(!e.className){return false}var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return i.test(e.className)};var n=function(e,t){if(!i(e,t)){e.className=!e.className?t:e.className.replace(/\s+$/,"")+" "+t}};var r=function(e,t){if(e.className){var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(i,function(e,t,i){return t===" "&&i===" "?" ":""})}};var o=function(e,t){if(e.currentStyle){return e.currentStyle[t]}else if(window.getComputedStyle){return window.getComputedStyle(e,null)[t]}};var s=function(t,i){var n=0,r=0,o,s=document,a,u;t=t;i=i||s.body;function l(e){var t,i,n=0,r=0;if(e){i=e.getBoundingClientRect();t=s.compatMode==="CSS1Compat"?s.documentElement:s.body;n=i.left+t.scrollLeft;r=i.top+t.scrollTop}return{x:n,y:r}}if(t&&t.getBoundingClientRect&&e.browser==="IE"&&(!s.documentMode||s.documentMode<8)){a=l(t);u=l(i);return{x:a.x-u.x,y:a.y-u.y}}o=t;while(o&&o!=i&&o.nodeType){n+=o.offsetLeft||0;r+=o.offsetTop||0;o=o.offsetParent}o=t.parentNode;while(o&&o!=i&&o.nodeType){n-=o.scrollLeft||0;r-=o.scrollTop||0;o=o.parentNode}return{x:n,y:r}};var a=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:i,addClass:n,removeClass:r,getStyle:o,getPos:s,getSize:a}});r("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(e,t,i){var n={};function r(){this.uid=i.guid()}i.extend(r.prototype,{init:function(){if(!this.uid){this.uid=i.guid("uid_")}},addEventListener:function(e,t,r,o){var s=this,a;if(!this.hasOwnProperty("uid")){this.uid=i.guid("uid_")}e=i.trim(e);if(/\s/.test(e)){i.each(e.split(/\s+/),function(e){s.addEventListener(e,t,r,o)});return}e=e.toLowerCase();r=parseInt(r,10)||0;a=n[this.uid]&&n[this.uid][e]||[];a.push({fn:t,priority:r,scope:o||this});if(!n[this.uid]){n[this.uid]={}}n[this.uid][e]=a},hasEventListener:function(e){var t;if(e){e=e.toLowerCase();t=n[this.uid]&&n[this.uid][e]}else{t=n[this.uid]}return t?t:false},removeEventListener:function(e,t){var r=this,o,s;e=e.toLowerCase();if(/\s/.test(e)){i.each(e.split(/\s+/),function(e){r.removeEventListener(e,t)});return}o=n[this.uid]&&n[this.uid][e];if(o){if(t){for(s=o.length-1;s>=0;s--){if(o[s].fn===t){o.splice(s,1);break}}}else{o=[]}if(!o.length){delete n[this.uid][e];if(i.isEmptyObj(n[this.uid])){delete n[this.uid]}}}},removeAllEventListeners:function(){if(n[this.uid]){delete n[this.uid]}},dispatchEvent:function(r){var o,s,a,u,l={},c=true,f;if(i.typeOf(r)!=="string"){u=r;if(i.typeOf(u.type)==="string"){r=u.type;if(u.total!==f&&u.loaded!==f){l.total=u.total;l.loaded=u.loaded}l.async=u.async||false}else{throw new t.EventException(t.EventException.UNSPECIFIED_EVENT_TYPE_ERR)}}if(r.indexOf("::")!==-1){(function(e){o=e[0];r=e[1]})(r.split("::"))}else{o=this.uid}r=r.toLowerCase();s=n[o]&&n[o][r];if(s){s.sort(function(e,t){return t.priority-e.priority});a=[].slice.call(arguments);a.shift();l.type=r;a.unshift(l);if(MXI_DEBUG&&e.debug.events){e.log("%cEvent '%s' fired on %s","color: #999;",l.type,(this.ctorName?this.ctorName+"::":"")+o)}var d=[];i.each(s,function(e){a[0].target=e.scope;if(l.async){d.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,a)===false)},1)})}else{d.push(function(t){t(e.fn.apply(e.scope,a)===false)})}});if(d.length){i.inSeries(d,function(e){c=!e})}}return c},bindOnce:function(e,t,i,n){var r=this;r.bind.call(this,e,function i(){r.unbind(e,i);return t.apply(this,arguments)},i,n)},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(e){var t=this;this.bind(e.join(" "),function(e){var t="on"+e.type.toLowerCase();if(i.typeOf(this[t])==="function"){this[t].apply(this,arguments)}});i.each(e,function(e){e="on"+e.toLowerCase(e);if(i.typeOf(t[e])==="undefined"){t[e]=null}})}});r.instance=new r;return r});r("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(e,t,i,n){var r={},o={};function s(n,r,a,u,l){var c=this,f,d=t.guid(r+"_"),m=l||"browser";n=n||{};o[d]=this;a=t.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},a);if(n.preferred_caps){m=s.getMode(u,n.preferred_caps,m)}if(MXI_DEBUG&&e.debug.runtime){e.log("\tdefault mode: %s",m)}f=function(){var e={};return{exec:function(t,i,n,r){if(f[i]){if(!e[t]){e[t]={context:this,instance:new f[i]}}if(e[t].instance[n]){return e[t].instance[n].apply(this,r)}}},removeInstance:function(t){delete e[t]},removeAllInstances:function(){var i=this;t.each(e,function(e,n){if(t.typeOf(e.instance.destroy)==="function"){e.instance.destroy.call(e.context)}i.removeInstance(n)})}}}();t.extend(this,{initialized:false,uid:d,type:r,mode:s.getMode(u,n.required_caps,m),shimid:d+"_container",clients:0,options:n,can:function(e,i){var n=arguments[2]||a;if(t.typeOf(e)==="string"&&t.typeOf(i)==="undefined"){e=s.parseCaps(e)}if(t.typeOf(e)==="object"){for(var r in e){if(!this.can(r,e[r],n)){return false}}return true}if(t.typeOf(n[e])==="function"){return n[e].call(this,i)}else{return i===n[e]}},getShimContainer:function(){var e,n=i.get(this.shimid);if(!n){e=i.get(this.options.container)||document.body;n=document.createElement("div");n.id=this.shimid;n.className="moxie-shim moxie-shim-"+this.type;t.extend(n.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});e.appendChild(n);e=null}return n},getShim:function(){return f},shimExec:function(e,t){var i=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,e,t,i)},exec:function(e,t){var i=[].slice.call(arguments,2);if(c[e]&&c[e][t]){return c[e][t].apply(this,i)}return c.shimExec.apply(this,arguments)},destroy:function(){if(!c){return}var e=i.get(this.shimid);if(e){e.parentNode.removeChild(e)}if(f){f.removeAllInstances()}this.unbindAll();delete o[this.uid];this.uid=null;d=c=f=e=null}});if(this.mode&&n.required_caps&&!this.can(n.required_caps)){this.mode=false}}s.order="html5,flash,silverlight,html4";s.getRuntime=function(e){return o[e]?o[e]:false};s.addConstructor=function(e,t){t.prototype=n.instance;r[e]=t};s.getConstructor=function(e){return r[e]||null};s.getInfo=function(e){var t=s.getRuntime(e);if(t){return{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}}return null};s.parseCaps=function(e){var i={};if(t.typeOf(e)!=="string"){return e||{}}t.each(e.split(","),function(e){i[e]=true});return i};s.can=function(e,t){var i,n=s.getConstructor(e),r;if(n){i=new n({required_caps:t});r=i.mode;i.destroy();return!!r}return false};s.thatCan=function(e,t){var i=(t||s.order).split(/\s*,\s*/);for(var n in i){if(s.can(i[n],e)){return i[n]}}return null};s.getMode=function(i,n,r){var o=null;if(t.typeOf(r)==="undefined"){r="browser"}if(n&&!t.isEmptyObj(i)){t.each(n,function(n,r){if(i.hasOwnProperty(r)){var s=i[r](n);if(typeof s==="string"){s=[s]}if(!o){o=s}else if(!(o=t.arrayIntersect(o,s))){if(MXI_DEBUG&&e.debug.runtime){e.log("\t\t%s: %s (conflicting mode requested: %s)",r,n,s)}return o=false}}if(MXI_DEBUG&&e.debug.runtime){e.log("\t\t%s: %s (compatible modes: %s)",r,n,o)}});if(o){return t.inArray(r,o)!==-1?r:o[0]}else if(o===false){return false}}return r};s.getGlobalEventTarget=function(){if(/^moxie\./.test(e.global_event_dispatcher)&&!e.can("access_global_ns")){var i=t.guid("moxie_event_target_");window[i]=function(e,t){n.instance.dispatchEvent(e,t)};e.global_event_dispatcher=i}return e.global_event_dispatcher};s.capTrue=function(){return true};s.capFalse=function(){return false};s.capTest=function(e){return function(){return!!e}};return s});r("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(e,t,i,n){return function r(){var o;i.extend(this,{connectRuntime:function(r){var s=this,a;function u(i){var a,l;if(!i.length){s.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR));o=null;return}a=i.shift().toLowerCase();l=n.getConstructor(a);if(!l){if(MXI_DEBUG&&e.debug.runtime){e.log("Constructor for '%s' runtime is not available.",a)}u(i);return}if(MXI_DEBUG&&e.debug.runtime){e.log("Trying runtime: %s",a);e.log(r)}o=new l(r);o.bind("Init",function(){o.initialized=true;if(MXI_DEBUG&&e.debug.runtime){e.log("Runtime '%s' initialized",o.type)}setTimeout(function(){o.clients++;s.ruid=o.uid;s.trigger("RuntimeInit",o)},1)});o.bind("Error",function(){if(MXI_DEBUG&&e.debug.runtime){e.log("Runtime '%s' failed to initialize",o.type)}o.destroy();u(i)});o.bind("Exception",function(i,n){var r=n.name+"(#"+n.code+")"+(n.message?", from: "+n.message:"");if(MXI_DEBUG&&e.debug.runtime){e.log("Runtime '%s' has thrown an exception: %s",this.type,r)}s.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.EXCEPTION_ERR,r))});if(MXI_DEBUG&&e.debug.runtime){e.log("\tselected mode: %s",o.mode)}if(!o.mode){o.trigger("Error");return}o.init()}if(i.typeOf(r)==="string"){a=r}else if(i.typeOf(r.ruid)==="string"){a=r.ruid}if(a){o=n.getRuntime(a);if(o){s.ruid=a;o.clients++;return o}else{throw new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)}}u((r.runtime_order||n.order).split(/\s*,\s*/))},disconnectRuntime:function(){if(o&&--o.clients<=0){o.destroy()}o=null},getRuntime:function(){if(o&&o.uid){return o}return o=null},exec:function(){return o?o.exec.apply(this,arguments):null},can:function(e){return o?o.can(e):false}})}});r("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(e,t,i){var n={};function r(o,s){function a(t,i,o){var s,a=n[this.uid];if(e.typeOf(a)!=="string"||!a.length){return null}s=new r(null,{type:o,size:i-t});s.detach(a.substr(t,s.size));return s}i.call(this);if(o){this.connectRuntime(o)}if(!s){s={}}else if(e.typeOf(s)==="string"){s={data:s}}e.extend(this,{uid:s.uid||e.guid("uid_"),ruid:o,size:s.size||0,type:s.type||"",slice:function(e,t,i){if(this.isDetached()){return a.apply(this,arguments)}return this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,i)},getSource:function(){if(!n[this.uid]){return null}return n[this.uid]},detach:function(e){if(this.ruid){this.getRuntime().exec.call(this,"Blob","destroy");this.disconnectRuntime();this.ruid=null}e=e||"";if(e.substr(0,5)=="data:"){var i=e.indexOf(";base64,");this.type=e.substring(5,i);e=t.atob(e.substring(i+8))}this.size=e.length;n[this.uid]=e},isDetached:function(){return!this.ruid&&e.typeOf(n[this.uid])==="string"},destroy:function(){this.detach();delete n[this.uid]}});if(s.data){this.detach(s.data)}else{n[this.uid]=s}}return r});r("moxie/core/I18n",["moxie/core/utils/Basic"],function(e){var t={};return{addI18n:function(i){return e.extend(t,i)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var i=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=i.shift();return e.typeOf(t)!=="undefined"?t:""})}}});r("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(e,t){var i=""+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb xlt xla,"+"application/vnd.ms-powerpoint,ppt pps pot ppa,"+"application/zip,zip,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"audio/mpeg,mp3 mpga mpega mp2,"+"audio/x-wav,wav,"+"audio/x-m4a,m4a,"+"audio/ogg,oga ogg,"+"audio/aiff,aiff aif,"+"audio/flac,flac,"+"audio/aac,aac,"+"audio/ac3,ac3,"+"audio/x-ms-wma,wma,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpg jpeg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"video/mpeg,mpeg mpg mpe m2v,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/webm,webm,"+"video/3gpp,3gpp 3gp,"+"video/3gpp2,3g2,"+"video/vnd.rn-realvideo,rv,"+"video/ogg,ogv,"+"video/x-matroska,mkv,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe";var n={};var r={};var o=function(e){var t=e.split(/,/),i,o,s;for(i=0;i<t.length;i+=2){s=t[i+1].split(/ /);for(o=0;o<s.length;o++){n[s[o]]=t[i]}r[t[i]]=s}};var s=function(t,i){var n,r,o,s,a=[];for(r=0;r<t.length;r++){n=t[r].extensions.toLowerCase().split(/\s*,\s*/);for(o=0;o<n.length;o++){if(n[o]==="*"){return[]}s=a[n[o]];if(i&&/^\w+$/.test(n[o])){a.push("."+n[o])}else if(s&&e.inArray(s,a)===-1){a.push(s)}else if(!s){return[]}}}return a};var a=function(t){var i=[];e.each(t,function(t){t=t.toLowerCase();if(t==="*"){i=[];return false}var n=t.match(/^(\w+)\/(\*|\w+)$/);if(n){if(n[2]==="*"){e.each(r,function(e,t){if(new RegExp("^"+n[1]+"/").test(t)){[].push.apply(i,r[t])}})}else if(r[t]){[].push.apply(i,r[t])}}});return i};var u=function(i){var n=[],r=[];if(e.typeOf(i)==="string"){i=e.trim(i).split(/\s*,\s*/)}r=a(i);n.push({title:t.translate("Files"),extensions:r.length?r.join(","):"*"});return n};var l=function(e){var t=e&&e.match(/\.([^.]+)$/);if(t){return t[1].toLowerCase()}return""};var c=function(e){return n[l(e)]||""};o(i);return{mimes:n,extensions:r,addMimeType:o,extList2mimes:s,mimes2exts:a,mimes2extList:u,getFileExtension:l,getFileMime:c}});r("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(e,t,i,n,r,o,s,a,u){var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];function c(o){if(MXI_DEBUG){t.log("Instantiating FileInput...")}var c,f,d;if(e.inArray(e.typeOf(o),["string","node"])!==-1){o={browse_button:o}}f=n.get(o.browse_button);if(!f){
throw new r.DOMException(r.DOMException.NOT_FOUND_ERR)}d={accept:[{title:s.translate("All Files"),extensions:"*"}],multiple:false,required_caps:false,container:f.parentNode||document.body};o=e.extend({},d,o);if(typeof o.required_caps==="string"){o.required_caps=a.parseCaps(o.required_caps)}if(typeof o.accept==="string"){o.accept=i.mimes2extList(o.accept)}c=n.get(o.container);if(!c){c=document.body}if(n.getStyle(c,"position")==="static"){c.style.position="relative"}c=f=null;u.call(this);e.extend(this,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){var t=this;t.bind("RuntimeInit",function(i,r){t.ruid=r.uid;t.shimid=r.shimid;t.bind("Ready",function(){t.trigger("Refresh")},999);t.bind("Refresh",function(){var t,i,s,a,u;s=n.get(o.browse_button);a=n.get(r.shimid);if(s){t=n.getPos(s,n.get(o.container));i=n.getSize(s);u=parseInt(n.getStyle(s,"z-index"),10)||0;if(a){e.extend(a.style,{top:t.y+"px",left:t.x+"px",width:i.w+"px",height:i.h+"px",zIndex:u+1})}}a=s=null});r.exec.call(t,"FileInput","init",o)});t.connectRuntime(e.extend({},o,{required_caps:{select_file:true}}))},getOption:function(e){return o[e]},setOption:function(e,t){if(!o.hasOwnProperty(e)){return}var n=o[e];switch(e){case"accept":if(typeof t==="string"){t=i.mimes2extList(t)}break;case"container":case"required_caps":throw new r.FileException(r.FileException.NO_MODIFICATION_ALLOWED_ERR)}o[e]=t;this.exec("FileInput","setOption",e,t);this.trigger("OptionChanged",e,t,n)},disable:function(t){var i=this.getRuntime();if(i){this.exec("FileInput","disable",e.typeOf(t)==="undefined"?true:t)}},refresh:function(){this.trigger("Refresh")},destroy:function(){var t=this.getRuntime();if(t){t.exec.call(this,"FileInput","destroy");this.disconnectRuntime()}if(e.typeOf(this.files)==="array"){e.each(this.files,function(e){e.destroy()})}this.files=null;this.unbindAll()}});this.handleEventProps(l)}c.prototype=o.instance;return c});r("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(e,t,i){function n(n,r){if(!r){r={}}i.apply(this,arguments);if(!this.type){this.type=t.getFileMime(r.name)}var o;if(r.name){o=r.name.replace(/\\/g,"/");o=o.substr(o.lastIndexOf("/")+1)}else if(this.type){var s=this.type.split("/")[0];o=e.guid((s!==""?s:"file")+"_");if(t.extensions[this.type]){o+="."+t.extensions[this.type][0]}}e.extend(this,{name:o||e.guid("file_"),relativePath:"",lastModifiedDate:r.lastModifiedDate||(new Date).toLocaleString()})}n.prototype=i.prototype;return n});r("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/core/utils/Env","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(e,t,i,n,r,o,s,a,u){var l=["ready","dragenter","dragleave","drop","error"];function c(i){if(MXI_DEBUG){r.log("Instantiating FileDrop...")}var o=this,a;if(typeof i==="string"){i={drop_zone:i}}a={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:true}};i=typeof i==="object"?n.extend({},a,i):a;i.container=t.get(i.drop_zone)||document.body;if(t.getStyle(i.container,"position")==="static"){i.container.style.position="relative"}if(typeof i.accept==="string"){i.accept=u.mimes2extList(i.accept)}s.call(o);n.extend(o,{uid:n.guid("uid_"),ruid:null,files:null,init:function(){o.bind("RuntimeInit",function(e,t){o.ruid=t.uid;t.exec.call(o,"FileDrop","init",i);o.dispatchEvent("ready")});o.connectRuntime(i)},destroy:function(){var e=this.getRuntime();if(e){e.exec.call(this,"FileDrop","destroy");this.disconnectRuntime()}this.files=null;this.unbindAll()}});this.handleEventProps(l)}c.prototype=a.instance;return c});r("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/runtime/RuntimeClient"],function(e,t,i,n,r,o){var s=["loadstart","progress","load","abort","error","loadend"];function a(){o.call(this);e.extend(this,{uid:e.guid("uid_"),readyState:a.EMPTY,result:null,error:null,readAsBinaryString:function(e){n.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){n.call(this,"readAsDataURL",e)},readAsText:function(e){n.call(this,"readAsText",e)},abort:function(){this.result=null;if(e.inArray(this.readyState,[a.EMPTY,a.DONE])!==-1){return}else if(this.readyState===a.LOADING){this.readyState=a.DONE}this.exec("FileReader","abort");this.trigger("abort");this.trigger("loadend")},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(s);this.bind("Error",function(e,t){this.readyState=a.DONE;this.error=t},999);this.bind("Load",function(e){this.readyState=a.DONE},999);function n(e,n){var o=this;this.trigger("loadstart");if(this.readyState===a.LOADING){this.trigger("error",new i.DOMException(i.DOMException.INVALID_STATE_ERR));this.trigger("loadend");return}if(!(n instanceof r)){this.trigger("error",new i.DOMException(i.DOMException.NOT_FOUND_ERR));this.trigger("loadend");return}this.result=null;this.readyState=a.LOADING;if(n.isDetached()){var s=n.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=s;break;case"readAsDataURL":this.result="data:"+n.type+";base64,"+t.btoa(s);break}this.readyState=a.DONE;this.trigger("load");this.trigger("loadend")}else{this.connectRuntime(n.ruid);this.exec("FileReader","read",e,n)}}}a.EMPTY=0;a.LOADING=1;a.DONE=2;a.prototype=n.instance;return a});r("moxie/core/utils/Url",["moxie/core/utils/Basic"],function(e){var t=function(i,n){var r=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o=r.length,s={http:80,https:443},a={},u=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[\da-fA-F:]+\]|[^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,l=u.exec(i||""),c,f=/^\/\/\w/.test(i);switch(e.typeOf(n)){case"undefined":n=t(document.location.href,false);break;case"string":n=t(n,false);break}while(o--){if(l[o]){a[r[o]]=l[o]}}c=!f&&!a.scheme;if(f||c){a.scheme=n.scheme}if(c){a.host=n.host;a.port=n.port;var d="";if(/^[^\/]/.test(a.path)){d=n.path;if(/\/[^\/]*\.[^\/]*$/.test(d)){d=d.replace(/\/[^\/]+$/,"/")}else{d=d.replace(/\/?$/,"/")}}a.path=d+(a.path||"")}if(!a.port){a.port=s[a.scheme]||80}a.port=parseInt(a.port,10);if(!a.path){a.path="/"}delete a.source;return a};var i=function(e){var i={http:80,https:443},n=typeof e==="object"?e:t(e);return n.scheme+"://"+n.host+(n.port!==i[n.scheme]?":"+n.port:"")+n.path+(n.query?n.query:"")};var n=function(e){function i(e){return[e.scheme,e.host,e.port].join("/")}if(typeof e==="string"){e=t(e)}return i(t())===i(e)};return{parseUrl:t,resolveUrl:i,hasSameOrigin:n}});r("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,i){function n(){this.uid=e.guid("uid_");t.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}n.prototype=i.instance;return n});r("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(e,t,i){return function(){t.call(this);e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return n.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return n.call(this,"readAsDataURL",e)},readAsText:function(e){return n.call(this,"readAsText",e)}});function n(e,t){if(t.isDetached()){var n=t.getSource();switch(e){case"readAsBinaryString":return n;case"readAsDataURL":return"data:"+t.type+";base64,"+i.btoa(n);case"readAsText":var r="";for(var o=0,s=n.length;o<s;o++){r+=String.fromCharCode(n[o])}return r}}else{var a=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);this.disconnectRuntime();return a}}}});r("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(e,t,i){function n(){var e,n=[];t.extend(this,{append:function(r,o){var s=this,a=t.typeOf(o);if(o instanceof i){e={name:r,value:o}}else if("array"===a){r+="[]";t.each(o,function(e){s.append(r,e)})}else if("object"===a){t.each(o,function(e,t){s.append(r+"["+t+"]",e)})}else if("null"===a||"undefined"===a||"number"===a&&isNaN(o)){s.append(r,"false")}else{n.push({name:r,value:o.toString()})}},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(i){t.each(n,function(e){i(e.value,e.name)});if(e){i(e.value,e.name)}},destroy:function(){e=null;n=[]}})}return n});r("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(e,t,i,n,r,o,s,a,u,l,c,f){var d={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};function m(){this.uid=e.guid("uid_")}m.prototype=i.instance;var h=["loadstart","progress","abort","error","load","timeout","loadend"];var p=1,g=2;function v(){var i=this,u={timeout:0,readyState:v.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},p=true,g,x,y={},w,_,E=null,b=null,R=false,I=false,A=false,T=false,S=false,O=false,D,C,N=null,M=null,F={},L,B="",P;e.extend(this,u,{uid:e.guid("uid_"),upload:new m,open:function(i,o,s,a,u){var l;if(!i||!o){throw new t.DOMException(t.DOMException.SYNTAX_ERR)}if(/[\u0100-\uffff]/.test(i)||n.utf8_encode(i)!==i){throw new t.DOMException(t.DOMException.SYNTAX_ERR)}if(!!~e.inArray(i.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])){x=i.toUpperCase()}if(!!~e.inArray(x,["CONNECT","TRACE","TRACK"])){throw new t.DOMException(t.DOMException.SECURITY_ERR)}o=n.utf8_encode(o);l=r.parseUrl(o);O=r.hasSameOrigin(l);g=r.resolveUrl(o);if((a||u)&&!O){throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR)}w=a||l.user;_=u||l.pass;p=s||true;if(p===false&&(z("timeout")||z("withCredentials")||z("responseType")!=="")){throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR)}R=!p;I=false;y={};k.call(this);z("readyState",v.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(i,r){var o=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(z("readyState")!==v.OPENED||I){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}if(/[\u0100-\uffff]/.test(i)||n.utf8_encode(i)!==i){throw new t.DOMException(t.DOMException.SYNTAX_ERR)}i=e.trim(i).toLowerCase();if(!!~e.inArray(i,o)||/^(proxy\-|sec\-)/.test(i)){return false}if(!y[i]){y[i]=r}else{y[i]+=", "+r}return true},hasRequestHeader:function(e){return e&&y[e.toLowerCase()]||false},getAllResponseHeaders:function(){return B||""},getResponseHeader:function(t){t=t.toLowerCase();if(S||!!~e.inArray(t,["set-cookie","set-cookie2"])){return null}if(B&&B!==""){if(!P){P={};e.each(B.split(/\r\n/),function(t){var i=t.split(/:\s+/);if(i.length===2){i[0]=e.trim(i[0]);P[i[0].toLowerCase()]={header:i[0],value:e.trim(i[1])}}})}if(P.hasOwnProperty(t)){return P[t].header+": "+P[t].value}}return null},overrideMimeType:function(i){var n,r;if(!!~e.inArray(z("readyState"),[v.LOADING,v.DONE])){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}i=e.trim(i.toLowerCase());if(/;/.test(i)&&(n=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){i=n[1];if(n[2]){r=n[2]}}if(!f.mimes[i]){throw new t.DOMException(t.DOMException.SYNTAX_ERR)}N=i;M=r},send:function(i,r){if(e.typeOf(r)==="string"){F={ruid:r}}else if(!r){F={}}else{F=r}if(this.readyState!==v.OPENED||I){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}if(i instanceof a){F.ruid=i.ruid;b=i.type||"application/octet-stream"}else if(i instanceof l){if(i.hasBlob()){var o=i.getBlob();F.ruid=o.ruid;b=o.type||"application/octet-stream"}}else if(typeof i==="string"){E="UTF-8";b="text/plain;charset=UTF-8";i=n.utf8_encode(i)}if(!this.withCredentials){this.withCredentials=F.required_caps&&F.required_caps.send_browser_cookies&&!O}A=!R&&this.upload.hasEventListener();S=false;T=!i;if(!R){I=true}U.call(this,i)},abort:function(){S=true;R=false;if(!~e.inArray(z("readyState"),[v.UNSENT,v.OPENED,v.DONE])){z("readyState",v.DONE);I=false;if(L){L.getRuntime().exec.call(L,"XMLHttpRequest","abort",T)}else{throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}T=true}else{z("readyState",v.UNSENT)}},destroy:function(){if(L){if(e.typeOf(L.destroy)==="function"){L.destroy()}L=null}this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null}}});this.handleEventProps(h.concat(["readystatechange"]));this.upload.handleEventProps(h);function z(e,t){if(!u.hasOwnProperty(e)){return}if(arguments.length===1){return c.can("define_property")?u[e]:i[e]}else{if(c.can("define_property")){u[e]=t}else{i[e]=t}}}function U(t){var i=this;D=(new Date).getTime();L=new s;function n(){if(L){L.destroy();L=null}i.dispatchEvent("loadend");i=null}function r(r){L.bind("LoadStart",function(e){z("readyState",v.LOADING);i.dispatchEvent("readystatechange");i.dispatchEvent(e);if(A){i.upload.dispatchEvent(e)}});L.bind("Progress",function(e){if(z("readyState")!==v.LOADING){z("readyState",v.LOADING);i.dispatchEvent("readystatechange")}i.dispatchEvent(e)});L.bind("UploadProgress",function(e){if(A){i.upload.dispatchEvent({type:"progress",lengthComputable:false,total:e.total,loaded:e.loaded})}});L.bind("Load",function(t){z("readyState",v.DONE);z("status",Number(r.exec.call(L,"XMLHttpRequest","getStatus")||0));z("statusText",d[z("status")]||"");z("response",r.exec.call(L,"XMLHttpRequest","getResponse",z("responseType")));if(!!~e.inArray(z("responseType"),["text",""])){z("responseText",z("response"))}else if(z("responseType")==="document"){z("responseXML",z("response"))}B=r.exec.call(L,"XMLHttpRequest","getAllResponseHeaders");i.dispatchEvent("readystatechange");if(z("status")>0){if(A){i.upload.dispatchEvent(t)}i.dispatchEvent(t)}else{S=true;i.dispatchEvent("error")}n()});L.bind("Abort",function(e){i.dispatchEvent(e);n()});L.bind("Error",function(e){S=true;z("readyState",v.DONE);i.dispatchEvent("readystatechange");T=true;i.dispatchEvent(e);n()});r.exec.call(L,"XMLHttpRequest","send",{url:g,method:x,async:p,user:w,password:_,headers:y,mimeType:b,encoding:E,responseType:i.responseType,withCredentials:i.withCredentials,options:F},t)}if(typeof F.required_caps==="string"){F.required_caps=o.parseCaps(F.required_caps)}F.required_caps=e.extend({},F.required_caps,{return_response_type:i.responseType});if(t instanceof l){F.required_caps.send_multipart=true}if(!e.isEmptyObj(y)){F.required_caps.send_custom_headers=true}if(!O){F.required_caps.do_cors=true}if(F.ruid){r(L.connectRuntime(F))}else{L.bind("RuntimeInit",function(e,t){r(t)});L.bind("RuntimeError",function(e,t){i.dispatchEvent("RuntimeError",t)});L.connectRuntime(F)}}function k(){z("responseText","");z("responseXML",null);z("response",null);z("status",0);z("statusText","");D=C=null}}v.UNSENT=0;v.OPENED=1;v.HEADERS_RECEIVED=2;v.LOADING=3;v.DONE=4;v.prototype=i.instance;return v});r("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,i,n){function r(){var n,o,s,a,u,l;i.call(this);e.extend(this,{uid:e.guid("uid_"),state:r.IDLE,result:null,transport:function(t,i,r){var o=this;r=e.extend({chunk_size:204798},r);if(n=r.chunk_size%3){r.chunk_size+=3-n}l=r.chunk_size;c.call(this);s=t;a=t.length;if(e.typeOf(r)==="string"||r.ruid){f.call(o,i,this.connectRuntime(r))}else{var u=function(e,t){o.unbind("RuntimeInit",u);f.call(o,i,t)};this.bind("RuntimeInit",u);this.connectRuntime(r)}},abort:function(){var e=this;e.state=r.IDLE;if(o){o.exec.call(e,"Transporter","clear");e.trigger("TransportingAborted")}c.call(e)},destroy:function(){this.unbindAll();o=null;this.disconnectRuntime();c.call(this)}});function c(){a=u=0;s=this.result=null}function f(t,i){var n=this;o=i;n.bind("TransportingProgress",function(t){u=t.loaded;if(u<a&&e.inArray(n.state,[r.IDLE,r.DONE])===-1){d.call(n)}},999);n.bind("TransportingComplete",function(){u=a;n.state=r.DONE;s=null;n.result=o.exec.call(n,"Transporter","getAsBlob",t||"")},999);n.state=r.BUSY;n.trigger("TransportingStarted");d.call(n)}function d(){var e=this,i,n=a-u;if(l>n){l=n}i=t.btoa(s.substr(u,l));o.exec.call(e,"Transporter","receive",i,a)}}r.IDLE=0;r.BUSY=1;r.DONE=2;r.prototype=n.instance;return r});r("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(e,t,i,n,r,o,s,a,u,l,c,f,d){var m=["progress","load","error","resize","embedded"];function h(){s.call(this);e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){l.apply(this,arguments)},resize:function(t){var n=this;var r;var o;var s={x:0,y:0,width:n.width,height:n.height};var a=e.extendIf({width:n.width,height:n.height,type:n.type||"image/jpeg",quality:90,crop:false,fit:true,preserveHeaders:true,resample:"default",multipass:true},t);try{if(!n.size){throw new i.DOMException(i.DOMException.INVALID_STATE_ERR)}if(n.width>h.MAX_RESIZE_WIDTH||n.height>h.MAX_RESIZE_HEIGHT){throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR)}r=n.meta&&n.meta.tiff&&n.meta.tiff.Orientation||1;if(e.inArray(r,[5,6,7,8])!==-1){var u=a.width;a.width=a.height;a.height=u}if(a.crop){o=Math.max(a.width/n.width,a.height/n.height);if(t.fit){s.width=Math.min(Math.ceil(a.width/o),n.width);s.height=Math.min(Math.ceil(a.height/o),n.height);o=a.width/s.width}else{s.width=Math.min(a.width,n.width);s.height=Math.min(a.height,n.height);o=1}if(typeof a.crop==="boolean"){a.crop="cc"}switch(a.crop.toLowerCase().replace(/_/,"-")){case"rb":case"right-bottom":s.x=n.width-s.width;s.y=n.height-s.height;break;case"cb":case"center-bottom":s.x=Math.floor((n.width-s.width)/2);s.y=n.height-s.height;break;case"lb":case"left-bottom":s.x=0;s.y=n.height-s.height;break;case"lt":case"left-top":s.x=0;s.y=0;break;case"ct":case"center-top":s.x=Math.floor((n.width-s.width)/2);s.y=0;break;case"rt":case"right-top":s.x=n.width-s.width;s.y=0;break;case"rc":case"right-center":case"right-middle":s.x=n.width-s.width;s.y=Math.floor((n.height-s.height)/2);break;case"lc":case"left-center":case"left-middle":s.x=0;s.y=Math.floor((n.height-s.height)/2);break;case"cc":case"center-center":case"center-middle":default:s.x=Math.floor((n.width-s.width)/2);s.y=Math.floor((n.height-s.height)/2)}s.x=Math.max(s.x,0);s.y=Math.max(s.y,0)}else{o=Math.min(a.width/n.width,a.height/n.height);if(o>1&&!a.fit){o=1}}this.exec("Image","resize",s,o,a)}catch(e){n.trigger("error",e.code)}},downsize:function(t){var i={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:false,fit:false,preserveHeaders:true,resample:"default"},n;if(typeof t==="object"){n=e.extend(i,t)}else{n=e.extend(i,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]})}this.resize(n)},crop:function(e,t,i){this.downsize(e,t,true,i)},getAsCanvas:function(){if(!u.can("create_canvas")){throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR)}return this.exec("Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size){throw new i.DOMException(i.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsBlob",e||"image/jpeg",t||90)},getAsDataURL:function(e,t){if(!this.size){throw new i.DOMException(i.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsDataURL",e||"image/jpeg",t||90)},getAsBinaryString:function(e,t){var i=this.getAsDataURL(e,t);return d.atob(i.substring(i.indexOf("base64,")+7))},embed:function(n,r){var o=this,s;var l=e.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,fit:true,resample:"nearest"},r);function c(t,r){var l=this;if(u.can("create_canvas")){var c=l.getAsCanvas();if(c){n.appendChild(c);c=null;l.destroy();o.trigger("embedded");return}}var f=l.getAsDataURL(t,r);if(!f){throw new i.ImageError(i.ImageError.WRONG_FORMAT)}if(u.can("use_data_uri_of",f.length)){n.innerHTML='<img src="'+f+'" width="'+l.width+'" height="'+l.height+'" alt="" />';l.destroy();o.trigger("embedded")}else{var m=new a;m.bind("TransportingComplete",function(){s=o.connectRuntime(this.result.ruid);o.bind("Embedded",function(){e.extend(s.getShimContainer().style,{top:"0px",left:"0px",width:l.width+"px",height:l.height+"px"});s=null},999);s.exec.call(o,"ImageView","display",this.result.uid,width,height);l.destroy()});m.transport(d.atob(f.substring(f.indexOf("base64,")+7)),t,{required_caps:{display_media:true},runtime_order:"flash,silverlight",container:n})}}try{if(!(n=t.get(n))){throw new i.DOMException(i.DOMException.INVALID_NODE_TYPE_ERR)}if(!this.size){throw new i.DOMException(i.DOMException.INVALID_STATE_ERR)}if(this.width>h.MAX_RESIZE_WIDTH||this.height>h.MAX_RESIZE_HEIGHT){}var f=new h;f.bind("Resize",function(){c.call(this,l.type,l.quality)});f.bind("Load",function(){this.downsize(l)});if(this.meta.thumb&&this.meta.thumb.width>=l.width&&this.meta.thumb.height>=l.height){f.load(this.meta.thumb.data)}else{f.clone(this,false)}return f}catch(e){this.trigger("error",e.code)}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,"Image","destroy");this.disconnectRuntime()}if(this.meta&&this.meta.thumb){this.meta.thumb.data.destroy()}this.unbindAll()}});this.handleEventProps(m);this.bind("Load Resize",function(){return n.call(this)},999);function n(e){try{if(!e){e=this.exec("Image","getInfo")}this.size=e.size;this.width=e.width;this.height=e.height;this.type=e.type;this.meta=e.meta;if(this.name===""){this.name=e.name}return true}catch(e){this.trigger("error",e.code);return false}}function l(t){var n=e.typeOf(t);try{if(t instanceof h){if(!t.size){throw new i.DOMException(i.DOMException.INVALID_STATE_ERR)}p.apply(this,arguments)}else if(t instanceof c){if(!~e.inArray(t.type,["image/jpeg","image/png"])){throw new i.ImageError(i.ImageError.WRONG_FORMAT)}g.apply(this,arguments)}else if(e.inArray(n,["blob","file"])!==-1){l.call(this,new f(null,t),arguments[1])}else if(n==="string"){if(t.substr(0,5)==="data:"){l.call(this,new c(null,{data:t}),arguments[1])}else{v.apply(this,arguments)}}else if(n==="node"&&t.nodeName.toLowerCase()==="img"){l.call(this,t.src,arguments[1])}else{throw new i.DOMException(i.DOMException.TYPE_MISMATCH_ERR)}}catch(e){this.trigger("error",e.code)}}function p(t,i){var n=this.connectRuntime(t.ruid);this.ruid=n.uid;n.exec.call(this,"Image","loadFromImage",t,e.typeOf(i)==="undefined"?true:i)}function g(t,i){var n=this;n.name=t.name||"";function r(e){n.ruid=e.uid;e.exec.call(n,"Image","loadFromBlob",t)}if(t.isDetached()){this.bind("RuntimeInit",function(e,t){r(t)});if(i&&typeof i.required_caps==="string"){i.required_caps=o.parseCaps(i.required_caps)}this.connectRuntime(e.extend({required_caps:{access_image_binary:true,resize_image:true}},i))}else{r(this.connectRuntime(t.ruid))}}function v(e,t){var i=this,n;n=new r;n.open("get",e);n.responseType="blob";n.onprogress=function(e){i.trigger(e)};n.onload=function(){g.call(i,n.response,true)};n.onerror=function(e){i.trigger(e)};n.onloadend=function(){n.destroy()};n.bind("RuntimeError",function(e,t){i.trigger("RuntimeError",t)});n.send(null,t)}}h.MAX_RESIZE_WIDTH=8192;h.MAX_RESIZE_HEIGHT=8192;h.prototype=l.instance;return h});r("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,i,n){var r="html5",s={};function a(t){var a=this,u=i.capTest,l=i.capTrue;var c=e.extend({access_binary:u(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return a.can("access_binary")&&!!s.Image},display_media:u((n.can("create_canvas")||n.can("use_data_uri_over32kb"))&&o("moxie/image/Image")),do_cors:u(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:u(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&(n.browser!=="IE"||n.verComp(n.version,9,">"))}()),filter_by_extension:u(function(){return!(n.browser==="Chrome"&&n.verComp(n.version,28,"<")||n.browser==="IE"&&n.verComp(n.version,10,"<")||n.browser==="Safari"&&n.verComp(n.version,7,"<")||n.browser==="Firefox"&&n.verComp(n.version,37,"<"))}()),return_response_headers:l,return_response_type:function(e){if(e==="json"&&!!window.JSON){return true}return n.can("return_response_type",e)},return_status_code:l,report_upload_progress:u(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return a.can("access_binary")&&n.can("create_canvas")},select_file:function(){return n.can("use_fileinput")&&window.File},select_folder:function(){return a.can("select_file")&&(n.browser==="Chrome"&&n.verComp(n.version,21,">=")||n.browser==="Firefox"&&n.verComp(n.version,42,">="))},select_multiple:function(){return a.can("select_file")&&!(n.browser==="Safari"&&n.os==="Windows")&&!(n.os==="iOS"&&n.verComp(n.osVersion,"7.0.0",">")&&n.verComp(n.osVersion,"8.0.0","<"))},send_binary_string:u(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:u(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||a.can("send_binary_string")},slice_blob:u(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return a.can("slice_blob")&&a.can("send_multipart")},summon_file_dialog:function(){return a.can("select_file")&&!(n.browser==="Firefox"&&n.verComp(n.version,4,"<")||n.browser==="Opera"&&n.verComp(n.version,12,"<")||n.browser==="IE"&&n.verComp(n.version,10,"<"))},upload_filesize:l,use_http_method:l},arguments[2]);i.call(this,t,arguments[1]||r,c);e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(a);e=a=null}}(this.destroy)});e.extend(this.getShim(),s)}i.addConstructor(r,a);return s});r("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(e,t){function i(){function e(e,t,i){var n;if(window.File.prototype.slice){try{e.slice();return e.slice(t,i)}catch(n){return e.slice(t,i-t)}}else if(n=window.File.prototype.webkitSlice||window.File.prototype.mozSlice){return n.call(e,t,i)}else{return null}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))};this.destroy=function(){this.getRuntime().getShim().removeInstance(this.uid)}}return e.Blob=i});r("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(e){var t={},i="moxie_"+e.guid();function n(){this.returnValue=false}function r(){this.cancelBubble=true}var o=function(o,s,a,u){var l,c;s=s.toLowerCase();if(o.addEventListener){l=a;o.addEventListener(s,l,false)}else if(o.attachEvent){l=function(){var e=window.event;if(!e.target){e.target=e.srcElement}e.preventDefault=n;e.stopPropagation=r;a(e)};o.attachEvent("on"+s,l)}if(!o[i]){o[i]=e.guid()}if(!t.hasOwnProperty(o[i])){t[o[i]]={}}c=t[o[i]];if(!c.hasOwnProperty(s)){c[s]=[]}c[s].push({func:l,orig:a,key:u})};var s=function(n,r,o){var s,a;r=r.toLowerCase();if(n[i]&&t[n[i]]&&t[n[i]][r]){s=t[n[i]][r]}else{return}for(var u=s.length-1;u>=0;u--){if(s[u].orig===o||s[u].key===o){if(n.removeEventListener){n.removeEventListener(r,s[u].func,false)}else if(n.detachEvent){n.detachEvent("on"+r,s[u].func)}s[u].orig=null;s[u].func=null;s.splice(u,1);if(o!==a){break}}}if(!s.length){delete t[n[i]][r]}if(e.isEmptyObj(t[n[i]])){delete t[n[i]];try{delete n[i]}catch(e){n[i]=a}}};var a=function(n,r){if(!n||!n[i]){return}e.each(t[n[i]],function(e,t){s(n,t,r)})};return{addEvent:o,removeEvent:s,removeAllEvents:a}});r("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,i,n,r,o,s){function a(){var e,a;i.extend(this,{init:function(u){var l=this,c=l.getRuntime(),f,d,m,h,p,g;e=u;m=o.extList2mimes(e.accept,c.can("filter_by_extension"));d=c.getShimContainer();d.innerHTML='<input id="'+c.uid+'" type="file" style="font-size:999px;opacity:0;"'+(e.multiple&&c.can("select_multiple")?"multiple":"")+(e.directory&&c.can("select_folder")?"webkitdirectory directory":"")+(m?' accept="'+m.join(",")+'"':"")+" />";f=n.get(c.uid);i.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});h=n.get(e.browse_button);a=n.getStyle(h,"z-index")||"auto";if(c.can("summon_file_dialog")){if(n.getStyle(h,"position")==="static"){h.style.position="relative"}r.addEvent(h,"click",function(e){var t=n.get(c.uid);if(t&&!t.disabled){t.click()}e.preventDefault()},l.uid);l.bind("Refresh",function(){p=parseInt(a,10)||1;n.get(e.browse_button).style.zIndex=p;this.getRuntime().getShimContainer().style.zIndex=p-1})}g=c.can("summon_file_dialog")?h:d;r.addEvent(g,"mouseover",function(){l.trigger("mouseenter")},l.uid);r.addEvent(g,"mouseout",function(){l.trigger("mouseleave")},l.uid);r.addEvent(g,"mousedown",function(){l.trigger("mousedown")},l.uid);r.addEvent(n.get(e.container),"mouseup",function(){l.trigger("mouseup")},l.uid);(c.can("summon_file_dialog")?f:h).setAttribute("tabindex",-1);f.onchange=function n(){l.files=[];i.each(this.files,function(i){var n="";if(e.directory){if(i.name=="."){return true}}if(i.webkitRelativePath){n="/"+i.webkitRelativePath.replace(/^\//,"")}i=new t(c.uid,i);i.relativePath=n;l.files.push(i)});if(s.browser!=="IE"&&s.browser!=="IEMobile"){this.value=""}else{var r=this.cloneNode(true);this.parentNode.replaceChild(r,this);r.onchange=n}if(l.files.length){l.trigger("change")}};l.trigger({type:"ready",async:true});d=null},setOption:function(e,t){var i=this.getRuntime();var r=n.get(i.uid);switch(e){case"accept":if(t){var s=t.mimes||o.extList2mimes(t,i.can("filter_by_extension"));r.setAttribute("accept",s.join(","))}else{r.removeAttribute("accept")}break;case"directory":if(t&&i.can("select_folder")){r.setAttribute("directory","");r.setAttribute("webkitdirectory","")}else{r.removeAttribute("directory");r.removeAttribute("webkitdirectory")}break;case"multiple":if(t&&i.can("select_multiple")){r.setAttribute("multiple","")}else{r.removeAttribute("multiple")}}},disable:function(e){var t=this.getRuntime(),i;if(i=n.get(t.uid)){i.disabled=!!e}},destroy:function(){
var t=this.getRuntime(),i=t.getShim(),o=t.getShimContainer(),s=e&&n.get(e.container),u=e&&n.get(e.browse_button);if(s){r.removeAllEvents(s,this.uid)}if(u){r.removeAllEvents(u,this.uid);u.style.zIndex=a}if(o){r.removeAllEvents(o,this.uid);o.innerHTML=""}i.removeInstance(this.uid);e=o=s=u=i=null}})}return e.FileInput=a});r("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(e,t,i,n,r,o){function s(){var e=[],s=[],a,u;i.extend(this,{init:function(t){var n=this,o;a=t;u=n.ruid;s=f(a.accept);o=a.container;r.addEvent(o,"dragover",function(e){if(!l(e)){return}e.preventDefault();e.dataTransfer.dropEffect="copy"},n.uid);r.addEvent(o,"drop",function(t){if(!l(t)){return}t.preventDefault();e=[];if(t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry){m(t.dataTransfer.items,function(){n.files=e;n.trigger("drop")})}else{i.each(t.dataTransfer.files,function(e){c(e)});n.files=e;n.trigger("drop")}},n.uid);r.addEvent(o,"dragenter",function(e){n.trigger("dragenter")},n.uid);r.addEvent(o,"dragleave",function(e){n.trigger("dragleave")},n.uid)},destroy:function(){r.removeAllEvents(a&&n.get(a.container),this.uid);u=e=s=a=null;this.getRuntime().getShim().removeInstance(this.uid)}});function l(e){if(!e.dataTransfer||!e.dataTransfer.types){return false}var t=i.toArray(e.dataTransfer.types||[]);return i.inArray("Files",t)!==-1||i.inArray("public.file-url",t)!==-1||i.inArray("application/x-moz-file",t)!==-1}function c(i,n){if(d(i)){var r=new t(u,i);r.relativePath=n||"";e.push(r)}}function f(e){var t=[];for(var n=0;n<e.length;n++){[].push.apply(t,e[n].extensions.split(/\s*,\s*/))}return i.inArray("*",t)===-1?t:[]}function d(e){if(!s.length){return true}var t=o.getFileExtension(e.name);return!t||i.inArray(t,s)!==-1}function m(e,t){var n=[];i.each(e,function(e){var t=e.webkitGetAsEntry();if(t){if(t.isFile){c(e.getAsFile(),t.fullPath)}else{n.push(t)}}});if(n.length){h(n,t)}else{t()}}function h(e,t){var n=[];i.each(e,function(e){n.push(function(t){p(e,t)})});i.inSeries(n,function(){t()})}function p(e,t){if(e.isFile){e.file(function(i){c(i,e.fullPath);t()},function(){t()})}else if(e.isDirectory){g(e,t)}else{t()}}function g(e,t){var i=[],n=e.createReader();function r(e){n.readEntries(function(t){if(t.length){[].push.apply(i,t);r(e)}else{e()}},e)}r(function(){h(i,t)})}}return e.FileDrop=s});r("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(e,t,i){function n(){var e,n=false;i.extend(this,{read:function(t,o){var s=this;s.result="";e=new window.FileReader;e.addEventListener("progress",function(e){s.trigger(e)});e.addEventListener("load",function(t){s.result=n?r(e.result):e.result;s.trigger(t)});e.addEventListener("error",function(t){s.trigger(t,e.error)});e.addEventListener("loadend",function(t){e=null;s.trigger(t)});if(i.typeOf(e[t])==="function"){n=false;e[t](o.getSource())}else if(t==="readAsBinaryString"){n=true;e.readAsDataURL(o.getSource())}},abort:function(){if(e){e.abort()}},destroy:function(){e=null;this.getRuntime().getShim().removeInstance(this.uid)}});function r(e){return t.atob(e.substring(e.indexOf("base64,")+7))}}return e.FileReader=n});r("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(e,t,i,n,r,o,s,a,u){function l(){var e=this,l,c;t.extend(this,{send:function(e,i){var r=this,a=u.browser==="Mozilla"&&u.verComp(u.version,4,">=")&&u.verComp(u.version,7,"<"),m=u.browser==="Android Browser",p=false;c=e.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();l=d();l.open(e.method,e.url,e.async,e.user,e.password);if(i instanceof o){if(i.isDetached()){p=true}i=i.getSource()}else if(i instanceof s){if(i.hasBlob()){if(i.getBlob().isDetached()){i=h.call(r,i);p=true}else if((a||m)&&t.typeOf(i.getBlob().getSource())==="blob"&&window.FileReader){f.call(r,e,i);return}}if(i instanceof s){var g=new window.FormData;i.each(function(e,t){if(e instanceof o){g.append(t,e.getSource())}else{g.append(t,e)}});i=g}}if(l.upload){if(e.withCredentials){l.withCredentials=true}l.addEventListener("load",function(e){r.trigger(e)});l.addEventListener("error",function(e){r.trigger(e)});l.addEventListener("progress",function(e){r.trigger(e)});l.upload.addEventListener("progress",function(e){r.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})}else{l.onreadystatechange=function t(){switch(l.readyState){case 1:break;case 2:break;case 3:var i,o;try{if(n.hasSameOrigin(e.url)){i=l.getResponseHeader("Content-Length")||0}if(l.responseText){o=l.responseText.length}}catch(e){i=o=0}r.trigger({type:"progress",lengthComputable:!!i,total:parseInt(i,10),loaded:o});break;case 4:l.onreadystatechange=function(){};try{if(l.status>=200&&l.status<400){r.trigger("load");break}}catch(e){}r.trigger("error");break}}}if(!t.isEmptyObj(e.headers)){t.each(e.headers,function(e,t){l.setRequestHeader(t,e)})}if(""!==e.responseType&&"responseType"in l){if("json"===e.responseType&&!u.can("return_response_type","json")){l.responseType="text"}else{l.responseType=e.responseType}}if(!p){l.send(i)}else{if(l.sendAsBinary){l.sendAsBinary(i)}else{(function(){var e=new Uint8Array(i.length);for(var t=0;t<i.length;t++){e[t]=i.charCodeAt(t)&255}l.send(e.buffer)})()}}r.trigger("loadstart")},getStatus:function(){try{if(l){return l.status}}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var n=new r(t.uid,l.response);var o=l.getResponseHeader("Content-Disposition");if(o){var s=o.match(/filename=([\'\"'])([^\1]+)\1/);if(s){c=s[2]}}n.name=c;if(!n.type){n.type=i.getFileMime(c)}return n;case"json":if(!u.can("return_response_type","json")){return l.status===200&&!!window.JSON?JSON.parse(l.responseText):null}return l.response;case"document":return m(l);default:return l.responseText!==""?l.responseText:null}}catch(e){return null}},getAllResponseHeaders:function(){try{return l.getAllResponseHeaders()}catch(e){}return""},abort:function(){if(l){l.abort()}},destroy:function(){e=c=null;this.getRuntime().getShim().removeInstance(this.uid)}});function f(t,i){var n=this,r,s;r=i.getBlob().getSource();s=new window.FileReader;s.onload=function(){i.append(i.getBlobName(),new o(null,{type:r.type,data:s.result}));e.send.call(n,t,i)};s.readAsBinaryString(r)}function d(){if(window.XMLHttpRequest&&!(u.browser==="IE"&&u.verComp(u.version,8,"<"))){return new window.XMLHttpRequest}else{return function(){var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"];for(var t=0;t<e.length;t++){try{return new ActiveXObject(e[t])}catch(e){}}}()}}function m(e){var t=e.responseXML;var i=e.responseText;if(u.browser==="IE"&&i&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))){t=new window.ActiveXObject("Microsoft.XMLDOM");t.async=false;t.validateOnParse=false;t.loadXML(i)}if(t){if(u.browser==="IE"&&t.parseError!==0||!t.documentElement||t.documentElement.tagName==="parsererror"){return null}}return t}function h(e){var t="----moxieboundary"+(new Date).getTime(),i="--",n="\r\n",r="",s=this.getRuntime();if(!s.can("send_binary_string")){throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR)}l.setRequestHeader("Content-Type","multipart/form-data; boundary="+t);e.each(function(e,s){if(e instanceof o){r+=i+t+n+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+n+"Content-Type: "+(e.type||"application/octet-stream")+n+n+e.getSource()+n}else{r+=i+t+n+'Content-Disposition: form-data; name="'+s+'"'+n+n+unescape(encodeURIComponent(e))+n}});r+=i+t+i+n;return r}}return e.XMLHttpRequest=l});r("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(e){function t(e){if(e instanceof ArrayBuffer){i.apply(this,arguments)}else{n.apply(this,arguments)}}e.extend(t.prototype,{littleEndian:false,read:function(e,t){var i,n,r;if(e+t>this.length()){throw new Error("You are trying to read outside the source boundaries.")}n=this.littleEndian?0:-8*(t-1);for(r=0,i=0;r<t;r++){i|=this.readByteAt(e+r)<<Math.abs(n+r*8)}return i},write:function(e,t,i){var n,r,o="";if(e>this.length()){throw new Error("You are trying to write outside the source boundaries.")}n=this.littleEndian?0:-8*(i-1);for(r=0;r<i;r++){this.writeByteAt(e+r,t>>Math.abs(n+r*8)&255)}},BYTE:function(e){return this.read(e,1)},SHORT:function(e){return this.read(e,2)},LONG:function(e){return this.read(e,4)},SLONG:function(e){var t=this.read(e,4);return t>2147483647?t-4294967296:t},CHAR:function(e){return String.fromCharCode(this.read(e,1))},STRING:function(e,t){return this.asArray("CHAR",e,t).join("")},asArray:function(e,t,i){var n=[];for(var r=0;r<i;r++){n[r]=this[e](t+r)}return n}});function i(t){var i=new DataView(t);e.extend(this,{readByteAt:function(e){return i.getUint8(e)},writeByteAt:function(e,t){i.setUint8(e,t)},SEGMENT:function(e,n,r){switch(arguments.length){case 2:return t.slice(e,e+n);case 1:return t.slice(e);case 3:if(r===null){r=new ArrayBuffer}if(r instanceof ArrayBuffer){var o=new Uint8Array(this.length()-n+r.byteLength);if(e>0){o.set(new Uint8Array(t.slice(0,e)),0)}o.set(new Uint8Array(r),e);o.set(new Uint8Array(t.slice(e+n)),e+r.byteLength);this.clear();t=o.buffer;i=new DataView(t);break}default:return t}},length:function(){return t?t.byteLength:0},clear:function(){i=t=null}})}function n(t){e.extend(this,{readByteAt:function(e){return t.charCodeAt(e)},writeByteAt:function(e,t){i(String.fromCharCode(t),e,1)},SEGMENT:function(e,n,r){switch(arguments.length){case 1:return t.substr(e);case 2:return t.substr(e,n);case 3:i(r!==null?r:"",e,n);break;default:return t}},length:function(){return t?t.length:0},clear:function(){t=null}});function i(e,i,n){n=arguments.length===3?n:t.length-i-1;t=t.substr(0,i)+e+t.substr(n+i)}}return t});r("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(e,t){return function i(n){var r=[],o,s,a,u=0;o=new e(n);if(o.SHORT(0)!==65496){o.clear();throw new t.ImageError(t.ImageError.WRONG_FORMAT)}s=2;while(s<=o.length()){a=o.SHORT(s);if(a>=65488&&a<=65495){s+=2;continue}if(a===65498||a===65497){break}u=o.SHORT(s+2)+2;if(a>=65505&&a<=65519){r.push({hex:a,name:"APP"+(a&15),start:s,length:u,segment:o.SEGMENT(s,u)})}s+=u}o.clear();return{headers:r,restore:function(t){var i,n,o;o=new e(t);s=o.SHORT(2)==65504?4+o.SHORT(4):2;for(n=0,i=r.length;n<i;n++){o.SEGMENT(s,0,r[n].segment);s+=r[n].length}t=o.SEGMENT();o.clear();return t},strip:function(t){var n,r,o,s;o=new i(t);r=o.headers;o.purge();n=new e(t);s=r.length;while(s--){n.SEGMENT(r[s].start,r[s].length,"")}t=n.SEGMENT();n.clear();return t},get:function(e){var t=[];for(var i=0,n=r.length;i<n;i++){if(r[i].name===e.toUpperCase()){t.push(r[i].segment)}}return t},set:function(e,t){var i=[],n,o,s;if(typeof t==="string"){i.push(t)}else{i=t}for(n=o=0,s=r.length;n<s;n++){if(r[n].name===e.toUpperCase()){r[n].segment=i[o];r[n].length=i[o].length;o++}if(o>=i.length){break}}},purge:function(){this.headers=r=[]}}}});r("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(e,i,n){function r(o){var s,a,u,l,c,f;i.call(this,o);a={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};u={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};l={tiffHeader:10};c=l.tiffHeader;s={clear:this.clear};e.extend(this,{read:function(){try{return r.prototype.read.apply(this,arguments)}catch(e){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}},write:function(){try{return r.prototype.write.apply(this,arguments)}catch(e){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(e){return this.LONG(e)/this.LONG(e+4)},SRATIONAL:function(e){return this.SLONG(e)/this.SLONG(e+4)},ASCII:function(e){return this.CHAR(e)},TIFF:function(){return f||null},EXIF:function(){var t=null;if(l.exifIFD){try{t=m.call(this,l.exifIFD,a.exif)}catch(e){return null}if(t.ExifVersion&&e.typeOf(t.ExifVersion)==="array"){for(var i=0,n="";i<t.ExifVersion.length;i++){n+=String.fromCharCode(t.ExifVersion[i])}t.ExifVersion=n}}return t},GPS:function(){var t=null;if(l.gpsIFD){try{t=m.call(this,l.gpsIFD,a.gps)}catch(e){return null}if(t.GPSVersionID&&e.typeOf(t.GPSVersionID)==="array"){t.GPSVersionID=t.GPSVersionID.join(".")}}return t},thumb:function(){if(l.IFD1){try{var e=m.call(this,l.IFD1,a.thumb);if("JPEGInterchangeFormat"in e){return this.SEGMENT(l.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}}catch(e){}}return null},setExif:function(e,t){if(e!=="PixelXDimension"&&e!=="PixelYDimension"){return false}return h.call(this,"exif",e,t)},clear:function(){s.clear();o=a=u=f=l=s=null}});if(this.SHORT(0)!==65505||this.STRING(4,5).toUpperCase()!=="EXIF\0"){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}this.littleEndian=this.SHORT(c)==18761;if(this.SHORT(c+=2)!==42){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}l.IFD0=l.tiffHeader+this.LONG(c+=2);f=m.call(this,l.IFD0,a.tiff);if("ExifIFDPointer"in f){l.exifIFD=l.tiffHeader+f.ExifIFDPointer;delete f.ExifIFDPointer}if("GPSInfoIFDPointer"in f){l.gpsIFD=l.tiffHeader+f.GPSInfoIFDPointer;delete f.GPSInfoIFDPointer}if(e.isEmptyObj(f)){f=null}var d=this.LONG(l.IFD0+this.SHORT(l.IFD0)*12+2);if(d){l.IFD1=l.tiffHeader+d}function m(i,r){var o=this;var s,a,c,f,d,m,h,p,g=[],v={};var x={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"};var y={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};s=o.SHORT(i);for(a=0;a<s;a++){g=[];h=i+2+a*12;c=r[o.SHORT(h)];if(c===t){continue}f=x[o.SHORT(h+=2)];d=o.LONG(h+=2);m=y[f];if(!m){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}h+=4;if(m*d>4){h=o.LONG(h)+l.tiffHeader}if(h+m*d>=this.length()){throw new n.ImageError(n.ImageError.INVALID_META_ERR)}if(f==="ASCII"){v[c]=e.trim(o.STRING(h,d).replace(/\0$/,""));continue}else{g=o.asArray(f,h,d);p=d==1?g[0]:g;if(u.hasOwnProperty(c)&&typeof p!="object"){v[c]=u[c][p]}else{v[c]=p}}}return v}function h(e,t,i){var n,r,o,s=0;if(typeof t==="string"){var u=a[e.toLowerCase()];for(var c in u){if(u[c]===t){t=c;break}}}n=l[e.toLowerCase()+"IFD"];r=this.SHORT(n);for(var f=0;f<r;f++){o=n+12*f+2;if(this.SHORT(o)==t){s=o+8;break}}if(!s){return false}try{this.write(s,i,4)}catch(e){return false}return true}}r.prototype=i.prototype;return r});r("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(e,t,i,n,r){function o(o){var s,a,u,l;s=new n(o);if(s.SHORT(0)!==65496){throw new t.ImageError(t.ImageError.WRONG_FORMAT)}a=new i(o);try{u=new r(a.get("app1")[0])}catch(e){}l=c.call(this);e.extend(this,{type:"image/jpeg",size:s.length(),width:l&&l.width||0,height:l&&l.height||0,setExif:function(t,i){if(!u){return false}if(e.typeOf(t)==="object"){e.each(t,function(e,t){u.setExif(t,e)})}else{u.setExif(t,i)}a.set("app1",u.SEGMENT())},writeHeaders:function(){if(!arguments.length){return a.restore(o)}return a.restore(arguments[0])},stripHeaders:function(e){return a.strip(e)},purge:function(){d.call(this)}});if(u){this.meta={tiff:u.TIFF(),exif:u.EXIF(),gps:u.GPS(),thumb:f()}}function c(e){var t=0,i,n;if(!e){e=s}while(t<=e.length()){i=e.SHORT(t+=2);if(i>=65472&&i<=65475){t+=5;return{height:e.SHORT(t),width:e.SHORT(t+=2)}}n=e.SHORT(t+=2);t+=n-2}return null}function f(){var e=u.thumb(),t,i;if(e){t=new n(e);i=c(t);t.clear();if(i){i.data=e;return i}}return null}function d(){if(!u||!a||!s){return}u.clear();a.purge();s.clear();l=a=u=s=null}}return o});r("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,t,i){function n(n){var r,o,s,a;r=new i(n);(function(){var t=0,i=0,n=[35152,20039,3338,6666];for(i=0;i<n.length;i++,t+=2){if(n[i]!=r.SHORT(t)){throw new e.ImageError(e.ImageError.WRONG_FORMAT)}}})();function u(){var e,t;e=c.call(this,8);if(e.type=="IHDR"){t=e.start;return{width:r.LONG(t),height:r.LONG(t+=4)}}return null}function l(){if(!r){return}r.clear();n=a=o=s=r=null}a=u.call(this);t.extend(this,{type:"image/png",size:r.length(),width:a.width,height:a.height,purge:function(){l.call(this)}});l.call(this);function c(e){var t,i,n,o;t=r.LONG(e);i=r.STRING(e+=4,4);n=e+=4;o=r.LONG(e+t);return{length:t,type:i,start:n,CRC:o}}}return n});r("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(e,t,i,n){return function(r){var o=[i,n],s;s=function(){for(var e=0;e<o.length;e++){try{return new o[e](r)}catch(e){}}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}();e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){r=null}});e.extend(this,s);this.purge=function(){s.purge();s=null}}});r("moxie/runtime/html5/image/ResizerCanvas",[],function(){function e(i,n,r){var o=i.width>i.height?"width":"height";var s=Math.round(i[o]*n);var a=false;if(r!=="nearest"&&(n<.5||n>2)){n=n<.5?.5:2;a=true}var u=t(i,n);if(a){return e(u,s/u[o],r)}else{return u}}function t(e,t){var i=e.width;var n=e.height;var r=Math.round(i*t);var o=Math.round(n*t);var s=document.createElement("canvas");s.width=r;s.height=o;s.getContext("2d").drawImage(e,0,0,i,n,0,0,r,o);e=null;return s}return{scale:e}});r("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/ResizerCanvas","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,i,n,r,o,s,a,u,l){function c(){var e=this,l,c,f,d,m,h=false,p=true;t.extend(this,{loadFromBlob:function(e){var t=this.getRuntime(),n=arguments.length>1?arguments[1]:true;if(!t.can("access_binary")){throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR)}m=e;if(e.isDetached()){d=e.getSource();w.call(this,d);return}else{_.call(this,e.getSource(),function(e){if(n){d=x(e)}w.call(this,e)})}},loadFromImage:function(e,t){this.meta=e.meta;m=new o(null,{name:e.name,size:e.size,type:e.type});w.call(this,t?d=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var e=this.getRuntime(),t;if(!c&&d&&e.can("access_image_binary")){c=new s(d)}t={width:g().width||0,height:g().height||0,type:m.type||u.getFileMime(m.name),size:d&&d.length||m.size||0,name:m.name||"",meta:null};if(p){t.meta=c&&c.meta||this.meta||{};if(t.meta&&t.meta.thumb&&!(t.meta.thumb.data instanceof r)){t.meta.thumb.data=new r(null,{type:"image/jpeg",data:t.meta.thumb.data})}}return t},resize:function(e,t,i){var n=document.createElement("canvas");n.width=e.width;n.height=e.height;n.getContext("2d").drawImage(g(),e.x,e.y,e.width,e.height,0,0,n.width,n.height);f=a.scale(n,t);p=i.preserveHeaders;if(!p){var r=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;f=E(f,r)}this.width=f.width;this.height=f.height;h=true;this.trigger("Resize")},getAsCanvas:function(){if(!f){f=v()}f.id=this.uid+"_canvas";return f},getAsBlob:function(t,i){if(t!==this.type){h=true;return new o(null,{name:m.name||"",type:t,data:e.getAsDataURL(t,i)})}return new o(null,{name:m.name||"",type:t,data:e.getAsBinaryString(t,i)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!h){return l.src}v();if("image/jpeg"!==e){return f.toDataURL("image/png")}else{try{return f.toDataURL("image/jpeg",t/100)}catch(e){return f.toDataURL("image/jpeg")}}},getAsBinaryString:function(t,i){if(!h){if(!d){d=x(e.getAsDataURL(t,i))}return d}if("image/jpeg"!==t){d=x(e.getAsDataURL(t,i))}else{var n;if(!i){i=90}v();try{n=f.toDataURL("image/jpeg",i/100)}catch(e){n=f.toDataURL("image/jpeg")}d=x(n);if(c){d=c.stripHeaders(d);if(p){if(c.meta&&c.meta.exif){c.setExif({PixelXDimension:this.width,PixelYDimension:this.height})}d=c.writeHeaders(d)}c.purge();c=null}}h=false;return d},destroy:function(){e=null;b.call(this);this.getRuntime().getShim().removeInstance(this.uid)}});function g(){if(!f&&!l){throw new i.ImageError(i.DOMException.INVALID_STATE_ERR)}return f||l}function v(){var e=g();if(e.nodeName.toLowerCase()=="canvas"){return e}f=document.createElement("canvas");f.width=e.width;f.height=e.height;f.getContext("2d").drawImage(e,0,0);return f}function x(e){return n.atob(e.substring(e.indexOf("base64,")+7))}function y(e,t){return"data:"+(t||"")+";base64,"+n.btoa(e)}function w(e){var t=this;l=new Image;l.onerror=function(){b.call(this);t.trigger("error",i.ImageError.WRONG_FORMAT)};l.onload=function(){t.trigger("load")};l.src=e.substr(0,5)=="data:"?e:y(e,m.type)}function _(e,t){var n=this,r;if(window.FileReader){r=new FileReader;r.onload=function(){t.call(n,this.result)};r.onerror=function(){n.trigger("error",i.ImageError.WRONG_FORMAT)};r.readAsDataURL(e)}else{return t.call(this,e.getAsDataURL())}}function E(e,i){var n=Math.PI/180;var r=document.createElement("canvas");var o=r.getContext("2d");var s=e.width;var a=e.height;if(t.inArray(i,[5,6,7,8])>-1){r.width=a;r.height=s}else{r.width=s;r.height=a}switch(i){case 2:o.translate(s,0);o.scale(-1,1);break;case 3:o.translate(s,a);o.rotate(180*n);break;case 4:o.translate(0,a);o.scale(1,-1);break;case 5:o.rotate(90*n);o.scale(1,-1);break;case 6:o.rotate(90*n);o.translate(0,-a);break;case 7:o.rotate(90*n);o.translate(s,-a);o.scale(-1,1);break;case 8:o.rotate(-90*n);o.translate(-s,0);break}o.drawImage(e,0,0,s,a);return r}function b(){if(c){c.purge();c=null}d=l=f=m=null;h=false}}return e.Image=c});r("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,i,n,r){var s="flash",a={};function u(){var e;try{e=navigator.plugins["Shockwave Flash"];e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){e="0.0"}}e=e.match(/\d+/g);return parseFloat(e[0]+"."+e[1])}function l(e){var n=i.get(e);if(n&&n.nodeName=="OBJECT"){if(t.browser==="IE"){n.style.display="none";(function t(){if(n.readyState==4){c(e)}else{setTimeout(t,10)}})()}else{n.parentNode.removeChild(n)}}}function c(e){var t=i.get(e);if(t){for(var n in t){if(typeof t[n]=="function"){t[n]=null}}t.parentNode.removeChild(t)}}function f(c){var f=this,d;c=e.extend({swf_url:t.swf_url},c);r.call(this,c,s,{access_binary:function(e){return e&&f.mode==="browser"},access_image_binary:function(e){return e&&f.mode==="browser"},display_media:r.capTest(o("moxie/image/Image")),do_cors:r.capTrue,drag_and_drop:false,report_upload_progress:function(){return f.mode==="client"},resize_image:r.capTrue,return_response_headers:false,return_response_type:function(t){if(t==="json"&&!!window.JSON){return true}return!e.arrayDiff(t,["","text","document"])||f.mode==="browser"},return_status_code:function(t){return f.mode==="browser"||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:function(e){return e&&f.mode==="browser"},send_browser_cookies:function(e){return e&&f.mode==="browser"},send_custom_headers:function(e){return e&&f.mode==="browser"},send_multipart:r.capTrue,slice_blob:function(e){return e&&f.mode==="browser"},stream_upload:function(e){return e&&f.mode==="browser"},summon_file_dialog:false,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||f.mode==="client"},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},slice_blob:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client");if(u()<11.3){if(MXI_DEBUG&&t.debug.runtime){t.log("\tFlash didn't meet minimal version requirement (11.3).")}this.mode=false}e.extend(this,{getShim:function(){return i.get(this.uid)},shimExec:function(e,t){var i=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,i)},init:function(){var i,o,s;s=this.getShimContainer();e.extend(s.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});i='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+c.swf_url+'" ';if(t.browser==="IE"){i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}i+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+c.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+r.getGlobalEventTarget()+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>";if(t.browser==="IE"){o=document.createElement("div");s.appendChild(o);o.outerHTML=i;o=s=null}else{s.innerHTML=i}d=setTimeout(function(){if(f&&!f.initialized){f.trigger("Error",new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR));if(MXI_DEBUG&&t.debug.runtime){t.log("\tFlash failed to initialize within a specified period of time (typically 5s).")}}},5e3)},destroy:function(e){return function(){l(f.uid);e.call(f);clearTimeout(d);c=d=e=f=null}}(this.destroy)},a)}r.addConstructor(s,f);return a});r("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var i={slice:function(e,i,n,r){var o=this.getRuntime();if(i<0){i=Math.max(e.size+i,0)}else if(i>0){i=Math.min(i,e.size)}if(n<0){n=Math.max(e.size+n,0)}else if(n>0){n=Math.min(n,e.size)}e=o.shimExec.call(this,"Blob","slice",i,n,r||"");if(e){e=new t(o.uid,e)}return e}};return e.Blob=i});r("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(e,t,i,n){var r={init:function(e){var r=this,o=this.getRuntime();var s=i.get(e.browse_button);if(s){s.setAttribute("tabindex",-1);s=null}this.bind("Change",function(){var e=o.shimExec.call(r,"FileInput","getFiles");r.files=[];n.each(e,function(e){r.files.push(new t(o.uid,e))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{accept:e.accept,multiple:e.multiple});this.trigger("ready")}};return e.FileInput=r});r("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function i(e,i){switch(i){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var n={read:function(e,t){var n=this;n.result="";if(e==="readAsDataURL"){n.result="data:"+(t.type||"")+";base64,"}n.bind("Progress",function(t,r){if(r){n.result+=i(r,e)}},999);return n.getRuntime().shimExec.call(this,"FileReader","readAsBase64",t.uid)}};return e.FileReader=n});r("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function i(e,i){switch(i){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var n={read:function(e,t){var n,r=this.getRuntime();n=r.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid);if(!n){return null}if(e==="readAsDataURL"){n="data:"+(t.type||"")+";base64,"+n}return i(n,e,t.type)}};return e.FileReaderSync=n});r("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var i={getAsBlob:function(e){var i=this.getRuntime(),n=i.shimExec.call(this,"Transporter","getAsBlob",e);if(n){return new t(i.uid,n)}return null}};return e.Transporter=i});r("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/runtime/flash/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/runtime/flash/runtime/Transporter"],function(e,t,i,n,r,o,s,a,u){var l={send:function(e,n){var r=this,o=r.getRuntime();function u(){e.transport=o.mode;o.shimExec.call(r,"XMLHttpRequest","send",e,n)}function l(e,t){o.shimExec.call(r,"XMLHttpRequest","appendBlob",e,t.uid);n=null;u()}function c(e,t){var i=new a;i.bind("TransportingComplete",function(){t(this.result)});i.transport(e.getSource(),e.type,{ruid:o.uid})}if(!t.isEmptyObj(e.headers)){t.each(e.headers,function(e,t){o.shimExec.call(r,"XMLHttpRequest","setRequestHeader",t,e.toString())})}if(n instanceof s){var f;n.each(function(e,t){if(e instanceof i){f=t}else{o.shimExec.call(r,"XMLHttpRequest","append",t,e)}})
;if(!n.hasBlob()){n=null;u()}else{var d=n.getBlob();if(d.isDetached()){c(d,function(e){d.destroy();l(f,e)})}else{l(f,d)}}}else if(n instanceof i){if(n.isDetached()){c(n,function(e){n.destroy();n=e.uid;u()})}else{n=n.uid;u()}}else{u()}},getResponse:function(e){var i,o,s=this.getRuntime();o=s.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob");if(o){o=new n(s.uid,o);if("blob"===e){return o}try{i=new r;if(!!~t.inArray(e,["","text"])){return i.readAsText(o)}else if("json"===e&&!!window.JSON){return JSON.parse(i.readAsText(o))}}finally{o.destroy()}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}};return e.XMLHttpRequest=l});r("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(e,t,i,n,r){var o={loadFromBlob:function(e){var t=this,n=t.getRuntime();function r(e){n.shimExec.call(t,"Image","loadFromBlob",e.uid);t=n=null}if(e.isDetached()){var o=new i;o.bind("TransportingComplete",function(){r(o.result.getSource())});o.transport(e.getSource(),e.type,{ruid:n.uid})}else{r(e.getSource())}},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getInfo:function(){var e=this.getRuntime(),t=e.shimExec.call(this,"Image","getInfo");if(t.meta&&t.meta.thumb&&t.meta.thumb.data&&!(e.meta.thumb.data instanceof n)){t.meta.thumb.data=new n(e.uid,t.meta.thumb.data)}return t},getAsBlob:function(e,t){var i=this.getRuntime(),r=i.shimExec.call(this,"Image","getAsBlob",e,t);if(r){return new n(i.uid,r)}return null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),i;if(!t){return null}i=new r;return i.readAsDataURL(t)}};return e.Image=o});r("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,i,n,r){var s="silverlight",a={};function u(e){var t=false,i=null,n,r,o,s,a,u=0;try{try{i=new ActiveXObject("AgControl.AgControl");if(i.IsVersionSupported(e)){t=true}i=null}catch(i){var l=navigator.plugins["Silverlight Plug-In"];if(l){n=l.description;if(n==="1.0.30226.2"){n="2.0.30226.2"}r=n.split(".");while(r.length>3){r.pop()}while(r.length<4){r.push(0)}o=e.split(".");while(o.length>4){o.pop()}do{s=parseInt(o[u],10);a=parseInt(r[u],10);u++}while(u<o.length&&s===a);if(s<=a&&!isNaN(s)){t=true}}}}catch(e){t=false}return t}function l(l){var c=this,f;l=e.extend({xap_url:t.xap_url},l);r.call(this,l,s,{access_binary:r.capTrue,access_image_binary:r.capTrue,display_media:r.capTest(o("moxie/image/Image")),do_cors:r.capTrue,drag_and_drop:false,report_upload_progress:r.capTrue,resize_image:r.capTrue,return_response_headers:function(e){return e&&c.mode==="client"},return_response_type:function(e){if(e!=="json"){return true}else{return!!window.JSON}},return_status_code:function(t){return c.mode==="client"||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:r.capTrue,send_browser_cookies:function(e){return e&&c.mode==="browser"},send_custom_headers:function(e){return e&&c.mode==="client"},send_multipart:r.capTrue,slice_blob:r.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:r.capTrue,use_http_method:function(t){return c.mode==="client"||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}});if(!u("2.0.31005.0")||t.browser==="Opera"){if(MXI_DEBUG&&t.debug.runtime){t.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely).")}this.mode=false}e.extend(this,{getShim:function(){return i.get(this.uid).content.Moxie},shimExec:function(e,t){var i=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,i)},init:function(){var e;e=this.getShimContainer();e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+l.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+",target="+r.getGlobalEventTarget()+'"/>'+"</object>";f=setTimeout(function(){if(c&&!c.initialized){c.trigger("Error",new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR));if(MXI_DEBUG&&t.debug.runtime){t.log("Silverlight failed to initialize within a specified period of time (5-10s).")}}},t.OS!=="Windows"?1e4:5e3)},destroy:function(e){return function(){e.call(c);clearTimeout(f);l=f=e=c=null}}(this.destroy)},a)}r.addConstructor(s,l);return a});r("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(e,t,i){return e.Blob=t.extend({},i)});r("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(e,t,i,n){function r(e){var t="";for(var i=0;i<e.length;i++){t+=(t!==""?"|":"")+e[i].title+" | *."+e[i].extensions.replace(/,/g,";*.")}return t}var o={init:function(e){var o=this,s=this.getRuntime();var a=i.get(e.browse_button);if(a){a.setAttribute("tabindex",-1);a=null}this.bind("Change",function(){var e=s.shimExec.call(o,"FileInput","getFiles");o.files=[];n.each(e,function(e){o.files.push(new t(s.uid,e))})},999);s.shimExec.call(this,"FileInput","init",r(e.accept),e.multiple);this.trigger("ready")},setOption:function(e,t){if(e=="accept"){t=r(t)}this.getRuntime().shimExec.call(this,"FileInput","setOption",e,t)}};return e.FileInput=o});r("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(e,t,i){var n={init:function(){var e=this,n=e.getRuntime(),r;r=n.getShimContainer();i.addEvent(r,"dragover",function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect="copy"},e.uid);i.addEvent(r,"dragenter",function(e){e.preventDefault();var i=t.get(n.uid).dragEnter(e);if(i){e.stopPropagation()}},e.uid);i.addEvent(r,"drop",function(e){e.preventDefault();var i=t.get(n.uid).dragDrop(e);if(i){e.stopPropagation()}},e.uid);return n.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=n});r("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(e,t,i){return e.FileReader=t.extend({},i)});r("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(e,t,i){return e.FileReaderSync=t.extend({},i)});r("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(e,t,i){return e.Transporter=t.extend({},i)});r("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/silverlight/file/FileReaderSync","moxie/runtime/silverlight/runtime/Transporter"],function(e,t,i,n,r){return e.XMLHttpRequest=t.extend({},i)});r("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(e,t,i,n){return e.Image=t.extend({},n,{getInfo:function(){var e=this.getRuntime(),n=["tiff","exif","gps","thumb"],r={meta:{}},o=e.shimExec.call(this,"Image","getInfo");if(o.meta){t.each(n,function(e){var t=o.meta[e],i,n,s,a;if(t&&t.keys){r.meta[e]={};for(n=0,s=t.keys.length;n<s;n++){i=t.keys[n];a=t[i];if(a){if(/^(\d|[1-9]\d+)$/.test(a)){a=parseInt(a,10)}else if(/^\d*\.\d+$/.test(a)){a=parseFloat(a)}r.meta[e][i]=a}}}});if(r.meta&&r.meta.thumb&&r.meta.thumb.data&&!(e.meta.thumb.data instanceof i)){r.meta.thumb.data=new i(e.uid,r.meta.thumb.data)}}r.width=parseInt(o.width,10);r.height=parseInt(o.height,10);r.size=parseInt(o.size,10);r.type=o.type;r.name=o.name;return r},resize:function(e,t,i){this.getRuntime().shimExec.call(this,"Image","resize",e.x,e.y,e.width,e.height,t,i.preserveHeaders,i.resample)}})});r("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,i,n){var r="html4",s={};function a(t){var a=this,u=i.capTest,l=i.capTrue;i.call(this,t,r,{access_binary:u(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:u((n.can("create_canvas")||n.can("use_data_uri_over32kb"))&&o("moxie/image/Image")),do_cors:false,drag_and_drop:false,filter_by_extension:u(function(){return!(n.browser==="Chrome"&&n.verComp(n.version,28,"<")||n.browser==="IE"&&n.verComp(n.version,10,"<")||n.browser==="Safari"&&n.verComp(n.version,7,"<")||n.browser==="Firefox"&&n.verComp(n.version,37,"<"))}()),resize_image:function(){return s.Image&&a.can("access_binary")&&n.can("create_canvas")},report_upload_progress:false,return_response_headers:false,return_response_type:function(t){if(t==="json"&&!!window.JSON){return true}return!!~e.inArray(t,["text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return n.can("use_fileinput")},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return a.can("select_file")},summon_file_dialog:function(){return a.can("select_file")&&!(n.browser==="Firefox"&&n.verComp(n.version,4,"<")||n.browser==="Opera"&&n.verComp(n.version,12,"<")||n.browser==="IE"&&n.verComp(n.version,10,"<"))},upload_filesize:l,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}});e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(a);e=a=null}}(this.destroy)});e.extend(this.getShim(),s)}i.addConstructor(r,a);return s});r("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,i,n,r,o,s){function a(){var e,a=[],u,l;function c(){var o=this,l=o.getRuntime(),f,d,m,h,p,g;g=i.guid("uid_");f=l.getShimContainer();if(e){m=n.get(e+"_form");if(m){i.extend(m.style,{top:"100%"});m.firstChild.setAttribute("tabindex",-1)}}h=document.createElement("form");h.setAttribute("id",g+"_form");h.setAttribute("method","post");h.setAttribute("enctype","multipart/form-data");h.setAttribute("encoding","multipart/form-data");i.extend(h.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});p=document.createElement("input");p.setAttribute("id",g);p.setAttribute("type","file");p.setAttribute("accept",a.join(","));if(l.can("summon_file_dialog")){p.setAttribute("tabindex",-1)}i.extend(p.style,{fontSize:"999px",opacity:0});h.appendChild(p);f.appendChild(h);i.extend(p.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});if(s.browser==="IE"&&s.verComp(s.version,10,"<")){i.extend(p.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"})}p.onchange=function(){var e;if(!this.value){return}if(this.files){e=this.files[0]}else{e={name:this.value}}e=new t(l.uid,e);this.onchange=function(){};c.call(o);o.files=[e];p.setAttribute("id",e.uid);h.setAttribute("id",e.uid+"_form");o.trigger("change");p=h=null};if(l.can("summon_file_dialog")){d=n.get(u.browse_button);r.removeEvent(d,"click",o.uid);r.addEvent(d,"click",function(e){if(p&&!p.disabled){p.click()}e.preventDefault()},o.uid)}e=g;f=m=d=null}i.extend(this,{init:function(e){var t=this,i=t.getRuntime(),s;u=e;a=o.extList2mimes(e.accept,i.can("filter_by_extension"));s=i.getShimContainer();(function(){var o,a,c;o=n.get(e.browse_button);l=n.getStyle(o,"z-index")||"auto";if(i.can("summon_file_dialog")){if(n.getStyle(o,"position")==="static"){o.style.position="relative"}t.bind("Refresh",function(){a=parseInt(l,10)||1;n.get(u.browse_button).style.zIndex=a;this.getRuntime().getShimContainer().style.zIndex=a-1})}else{o.setAttribute("tabindex",-1)}c=i.can("summon_file_dialog")?o:s;r.addEvent(c,"mouseover",function(){t.trigger("mouseenter")},t.uid);r.addEvent(c,"mouseout",function(){t.trigger("mouseleave")},t.uid);r.addEvent(c,"mousedown",function(){t.trigger("mousedown")},t.uid);r.addEvent(n.get(e.container),"mouseup",function(){t.trigger("mouseup")},t.uid);o=null})();c.call(this);s=null;t.trigger({type:"ready",async:true})},setOption:function(t,i){var r=this.getRuntime();var s;if(t=="accept"){a=i.mimes||o.extList2mimes(i,r.can("filter_by_extension"))}s=n.get(e);if(s){s.setAttribute("accept",a.join(","))}},disable:function(t){var i;if(i=n.get(e)){i.disabled=!!t}},destroy:function(){var t=this.getRuntime(),i=t.getShim(),o=t.getShimContainer(),s=u&&n.get(u.container),c=u&&n.get(u.browse_button);if(s){r.removeAllEvents(s,this.uid)}if(c){r.removeAllEvents(c,this.uid);c.style.zIndex=l}if(o){r.removeAllEvents(o,this.uid);o.innerHTML=""}i.removeInstance(this.uid);e=a=u=o=s=c=i=null}})}return e.FileInput=a});r("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(e,t){return e.FileReader=t});r("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(e,t,i,n,r,o,s,a){function u(){var e,u,l;function c(e){var t=this,n,r,s,a,u=false;if(!l){return}n=l.id.replace(/_iframe$/,"");r=i.get(n+"_form");if(r){s=r.getElementsByTagName("input");a=s.length;while(a--){switch(s[a].getAttribute("type")){case"hidden":s[a].parentNode.removeChild(s[a]);break;case"file":u=true;break}}s=[];if(!u){r.parentNode.removeChild(r)}r=null}setTimeout(function(){o.removeEvent(l,"load",t.uid);if(l.parentNode){l.parentNode.removeChild(l)}var i=t.getRuntime().getShimContainer();if(!i.children.length){i.parentNode.removeChild(i)}i=l=null;e()},1)}t.extend(this,{send:function(f,d){var m=this,h=m.getRuntime(),p,g,v,x;e=u=null;function y(){var i=h.getShimContainer()||document.body,r=document.createElement("div");r.innerHTML='<iframe id="'+p+'_iframe" name="'+p+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';l=r.firstChild;i.appendChild(l);o.addEvent(l,"load",function(){var i;try{i=l.contentWindow.document||l.contentDocument||window.frames[l.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(i.title)){e=i.title.replace(/^(\d+).*$/,"$1")}else{e=200;u=t.trim(i.body.innerHTML);m.trigger({type:"progress",loaded:u.length,total:u.length});if(x){m.trigger({type:"uploadprogress",loaded:x.size||1025,total:x.size||1025})}}}catch(t){if(n.hasSameOrigin(f.url)){e=404}else{c.call(m,function(){m.trigger("error")});return}}c.call(m,function(){m.trigger("load")})},m.uid)}if(d instanceof a&&d.hasBlob()){x=d.getBlob();p=x.uid;v=i.get(p);g=i.get(p+"_form");if(!g){throw new r.DOMException(r.DOMException.NOT_FOUND_ERR)}}else{p=t.guid("uid_");g=document.createElement("form");g.setAttribute("id",p+"_form");g.setAttribute("method",f.method);g.setAttribute("enctype","multipart/form-data");g.setAttribute("encoding","multipart/form-data");h.getShimContainer().appendChild(g)}g.setAttribute("target",p+"_iframe");if(d instanceof a){d.each(function(e,i){if(e instanceof s){if(v){v.setAttribute("name",i)}}else{var n=document.createElement("input");t.extend(n,{type:"hidden",name:i,value:e});if(v){g.insertBefore(n,v)}else{g.appendChild(n)}}})}g.setAttribute("action",f.url);y();g.submit();m.trigger("loadstart")},getStatus:function(){return e},getResponse:function(e){if("json"===e){if(t.typeOf(u)==="string"&&!!window.JSON){try{return JSON.parse(u.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(e){return null}}}else if("document"===e){}return u},abort:function(){var e=this;if(l&&l.contentWindow){if(l.contentWindow.stop){l.contentWindow.stop()}else if(l.contentWindow.document.execCommand){l.contentWindow.document.execCommand("Stop")}else{l.src="about:blank"}}c.call(this,function(){e.dispatchEvent("abort")})},destroy:function(){this.getRuntime().getShim().removeInstance(this.uid)}})}return e.XMLHttpRequest=u});r("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(e,t){return e.Image=t});a(["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Dom","moxie/core/EventTarget","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/core/I18n","moxie/core/utils/Mime","moxie/file/FileInput","moxie/file/File","moxie/file/FileDrop","moxie/file/FileReader","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/image/Image","moxie/core/utils/Events","moxie/runtime/html5/image/ResizerCanvas"])})(this)});(function(e,t,i){var n=window.setTimeout;var r={};var o=t.core.utils;var s=t.runtime.Runtime;function a(e){var t=e.required_features,i={};function n(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};if(r[e]){i[r[e]]=t}else if(!n){i[e]=t}}if(typeof t==="string"){u.each(t.split(/\s*,\s*/),function(e){n(e,true)})}else if(typeof t==="object"){u.each(t,function(e,t){n(t,e)})}else if(t===true){if(e.chunk_size&&e.chunk_size>0){i.slice_blob=true}if(!u.isEmptyObj(e.resize)||e.multipart===false){i.send_binary_string=true}if(e.http_method){i.use_http_method=e.http_method}u.each(e,function(e,t){n(t,!!e,true)})}return i}var u={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,moxie:t,mimeTypes:o.Mime.mimes,ua:o.Env,typeOf:o.Basic.typeOf,extend:o.Basic.extend,guid:o.Basic.guid,getAll:function e(t){var i=[],n;if(u.typeOf(t)!=="array"){t=[t]}var r=t.length;while(r--){n=u.get(t[r]);if(n){i.push(n)}}return i.length?i:null},get:o.Dom.get,each:o.Basic.each,getPos:o.Dom.getPos,getSize:o.Dom.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return e?(""+e).replace(i,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:o.Basic.toArray,inArray:o.Basic.inArray,inSeries:o.Basic.inSeries,addI18n:t.core.I18n.addI18n,translate:t.core.I18n.translate,sprintf:o.Basic.sprintf,isEmptyObj:o.Basic.isEmptyObj,hasClass:o.Dom.hasClass,addClass:o.Dom.addClass,removeClass:o.Dom.removeClass,getStyle:o.Dom.getStyle,addEvent:o.Events.addEvent,removeEvent:o.Events.removeEvent,removeAllEvents:o.Events.removeAllEvents,cleanName:function(e){var t,i;i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<i.length;t+=2){e=e.replace(i[t],i[t+1])}e=e.replace(/\s+/g,"_");e=e.replace(/[^a-z0-9_\-\.]+/gi,"");return e},buildUrl:function(e,t){var i="";u.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(i){e+=(e.indexOf("?")>0?"&":"?")+i}return e},formatSize:function(e){if(e===i||/\D/.test(e)){return u.translate("N/A")}function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}var n=Math.pow(1024,4);if(e>n){return t(e/n,1)+" "+u.translate("tb")}if(e>(n/=1024)){return t(e/n,1)+" "+u.translate("gb")}if(e>(n/=1024)){return t(e/n,1)+" "+u.translate("mb")}if(e>1024){return Math.round(e/1024)+" "+u.translate("kb")}return e+" "+u.translate("b")},parseSize:o.Basic.parseSizeStr,predictRuntime:function(e,t){var i,n;i=new u.Uploader(e);n=s.thatCan(i.getOption().required_features,t||e.runtimes);i.destroy();return n},addFileFilter:function(e,t){r[e]=t}};u.addFileFilter("mime_types",function(e,t,i){if(e.length&&!e.regexp.test(t.name)){this.trigger("Error",{code:u.FILE_EXTENSION_ERROR,message:u.translate("File extension error."),file:t});i(false)}else{i(true)}});u.addFileFilter("max_file_size",function(e,t,i){var n;e=u.parseSize(e);if(t.size!==n&&e&&t.size>e){this.trigger("Error",{code:u.FILE_SIZE_ERROR,message:u.translate("File size error."),file:t});i(false)}else{i(true)}});u.addFileFilter("prevent_duplicates",function(e,t,i){if(e){var n=this.files.length;while(n--){if(t.name===this.files[n].name&&t.size===this.files[n].size){this.trigger("Error",{code:u.FILE_DUPLICATE_ERROR,message:u.translate("Duplicate file error."),file:t});i(false);return}}}i(true)});u.addFileFilter("prevent_empty",function(e,t,n){if(e&&!t.size&&t.size!==i){this.trigger("Error",{code:u.FILE_SIZE_ERROR,message:u.translate("File size error."),file:t});n(false)}else{n(true)}});u.Uploader=function(e){var o=u.guid(),l,c=[],f={},d=[],m=[],h,p,g=false,v;function x(){var e,t=0,i;if(this.state==u.STARTED){for(i=0;i<c.length;i++){if(!e&&c[i].status==u.QUEUED){e=c[i];if(this.trigger("BeforeUpload",e)){e.status=u.UPLOADING;this.trigger("UploadFile",e)}}else{t++}}if(t==c.length){if(this.state!==u.STOPPED){this.state=u.STOPPED;this.trigger("StateChanged")}this.trigger("UploadComplete",c)}}}function y(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100;w()}function w(){var e,t;var n;var r=0;p.reset();for(e=0;e<c.length;e++){t=c[e];if(t.size!==i){p.size+=t.origSize;n=t.loaded*t.origSize/t.size;if(!t.completeTimestamp||t.completeTimestamp>h){r+=n}p.loaded+=n}else{p.size=i}if(t.status==u.DONE){p.uploaded++}else if(t.status==u.FAILED){p.failed++}else{p.queued++}}if(p.size===i){p.percent=c.length>0?Math.ceil(p.uploaded/c.length*100):0}else{p.bytesPerSec=Math.ceil(r/((+new Date-h||1)/1e3));p.percent=p.size>0?Math.ceil(p.loaded/p.size*100):0}}function _(){var e=d[0]||m[0];if(e){return e.getRuntime().uid}return false}function E(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged");e.refresh()});this.bind("CancelUpload",D);this.bind("BeforeUpload",A);this.bind("UploadFile",T);this.bind("UploadProgress",S);this.bind("StateChanged",O);this.bind("QueueChanged",w);this.bind("Error",N);this.bind("FileUploaded",C);this.bind("Destroy",M)}function b(e,i){var n=this,r=0,o=[];var a={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:f,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};u.each(e.runtimes.split(/\s*,\s*/),function(t){if(e[t]){a[t]=e[t]}});if(e.browse_button){u.each(e.browse_button,function(i){o.push(function(o){var l=new t.file.FileInput(u.extend({},a,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:i}));l.onready=function(){var e=s.getInfo(this.ruid);u.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")});r++;d.push(this);o()};l.onchange=function(){n.addFile(this.files)};l.bind("mouseenter mouseleave mousedown mouseup",function(t){if(!g){if(e.browse_button_hover){if("mouseenter"===t.type){u.addClass(i,e.browse_button_hover)}else if("mouseleave"===t.type){u.removeClass(i,e.browse_button_hover)}}if(e.browse_button_active){if("mousedown"===t.type){u.addClass(i,e.browse_button_active)}else if("mouseup"===t.type){u.removeClass(i,e.browse_button_active)}}}});l.bind("mousedown",function(){n.trigger("Browse")});l.bind("error runtimeerror",function(){l=null;o()});l.init()})})}if(e.drop_element){u.each(e.drop_element,function(e){o.push(function(i){var o=new t.file.FileDrop(u.extend({},a,{drop_zone:e}));o.onready=function(){var e=s.getInfo(this.ruid);u.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")});r++;m.push(this);i()};o.ondrop=function(){n.addFile(this.files)};o.bind("error runtimeerror",function(){o=null;i()});o.init()})})}u.inSeries(o,function(){if(typeof i==="function"){i(r)}})}function R(e,n,r,o){var s=new t.image.Image;try{s.onload=function(){if(n.width>this.width&&n.height>this.height&&n.quality===i&&n.preserve_headers&&!n.crop){this.destroy();o(e)}else{s.downsize(n.width,n.height,n.crop,n.preserve_headers)}};s.onresize=function(){var t=this.getAsBlob(e.type,n.quality);this.destroy();o(t)};s.bind("error runtimeerror",function(){this.destroy();o(e)});s.load(e,r)}catch(t){o(e)}}function I(e,i,n){var r=this,o=false;function c(e,i,n){var s=l[e];switch(e){case"max_file_size":if(e==="max_file_size"){l.max_file_size=l.filters.max_file_size=i}break;case"chunk_size":if(i=u.parseSize(i)){l[e]=i;l.send_file_name=true}break;case"multipart":l[e]=i;if(!i){l.send_file_name=true}break;case"http_method":l[e]=i.toUpperCase()==="PUT"?"PUT":"POST";break;case"unique_names":l[e]=i;if(i){l.send_file_name=true}break;case"filters":if(u.typeOf(i)==="array"){i={mime_types:i}}if(n){u.extend(l.filters,i)}else{l.filters=i}if(i.mime_types){if(u.typeOf(i.mime_types)==="string"){i.mime_types=t.core.utils.Mime.mimes2extList(i.mime_types)}i.mime_types.regexp=function(e){var t=[];u.each(e,function(e){u.each(e.extensions.split(/,/),function(e){if(/^\s*\*\s*$/.test(e)){t.push("\\.*")}else{t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))}})});return new RegExp("("+t.join("|")+")$","i")}(i.mime_types);l.filters.mime_types=i.mime_types}break;case"resize":if(i){l.resize=u.extend({preserve_headers:true,crop:false},i)}else{l.resize=false}break;case"prevent_duplicates":l.prevent_duplicates=l.filters.prevent_duplicates=!!i;break;case"container":case"browse_button":case"drop_element":i="container"===e?u.get(i):u.getAll(i);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":l[e]=i;if(!n){o=true}break;default:l[e]=i}if(!n){r.trigger("OptionChanged",e,i,s)}}if(typeof e==="object"){u.each(e,function(e,t){c(t,e,n)})}else{c(e,i,n)}if(n){l.required_features=a(u.extend({},l));f=a(u.extend({},l,{required_features:true}))}else if(o){r.trigger("Destroy");b.call(r,l,function(e){if(e){r.runtime=s.getInfo(_()).type;r.trigger("Init",{runtime:r.runtime});r.trigger("PostInit")}else{r.trigger("Error",{code:u.INIT_ERROR,message:u.translate("Init error.")})}})}}function A(e,t){if(e.settings.unique_names){var i=t.name.match(/\.([^.]+)$/),n="part";if(i){n=i[1]}t.target_name=t.id+"."+n}}function T(e,i){var r=e.settings.url;var o=e.settings.chunk_size;var s=e.settings.max_retries;var a=e.features;var l=0;var c;var d={runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:f,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url};if(i.loaded){l=i.loaded=o?o*Math.floor(i.loaded/o):0}function m(){if(s-- >0){n(h,1e3)}else{i.loaded=l;e.trigger("Error",{code:u.HTTP_ERROR,message:u.translate("HTTP Error."),file:i,response:v.responseText,status:v.status,responseHeaders:v.getAllResponseHeaders()})}}function h(){var t,n={},r;if(i.status!==u.UPLOADING||e.state===u.STOPPED){return}if(e.settings.send_file_name){n.name=i.target_name||i.name}if(o&&a.chunks&&c.size>o){r=Math.min(o,c.size-l);t=c.slice(l,l+r)}else{r=c.size;t=c}if(o&&a.chunks){if(e.settings.send_chunk_number){n.chunk=Math.ceil(l/o);n.chunks=Math.ceil(c.size/o)}else{n.offset=l;n.total=c.size}}if(e.trigger("BeforeChunkUpload",i,n,t,l)){p(n,t,r)}}function p(o,f,p){var g;v=new t.xhr.XMLHttpRequest;if(v.upload){v.upload.onprogress=function(t){i.loaded=Math.min(i.size,l+t.loaded);e.trigger("UploadProgress",i)}}v.onload=function(){if(v.status<200||v.status>=400){m();return}s=e.settings.max_retries;if(p<c.size){f.destroy();l+=p;i.loaded=Math.min(l,c.size);e.trigger("ChunkUploaded",i,{offset:i.loaded,total:c.size,response:v.responseText,status:v.status,responseHeaders:v.getAllResponseHeaders()});if(u.ua.browser==="Android Browser"){e.trigger("UploadProgress",i)}}else{i.loaded=i.size}f=g=null;if(!l||l>=c.size){if(i.size!=i.origSize){c.destroy();c=null}e.trigger("UploadProgress",i);i.status=u.DONE;i.completeTimestamp=+new Date;e.trigger("FileUploaded",i,{response:v.responseText,status:v.status,responseHeaders:v.getAllResponseHeaders()})}else{n(h,1)}};v.onerror=function(){m()};v.onloadend=function(){this.destroy()};if(e.settings.multipart&&a.multipart){v.open(e.settings.http_method,r,true);u.each(e.settings.headers,function(e,t){v.setRequestHeader(t,e)});g=new t.xhr.FormData;u.each(u.extend(o,e.settings.multipart_params),function(e,t){g.append(t,e)});g.append(e.settings.file_data_name,f);v.send(g,d)}else{r=u.buildUrl(e.settings.url,u.extend(o,e.settings.multipart_params));v.open(e.settings.http_method,r,true);u.each(e.settings.headers,function(e,t){v.setRequestHeader(t,e)});if(!v.hasRequestHeader("Content-Type")){v.setRequestHeader("Content-Type","application/octet-stream")}v.send(f,d)}}c=i.getSource();if(!u.isEmptyObj(e.settings.resize)&&u.inArray(c.type,["image/jpeg","image/png"])!==-1){R(c,e.settings.resize,d,function(e){c=e;i.size=e.size;h()})}else{h()}}function S(e,t){y(t)}function O(e){if(e.state==u.STARTED){h=+new Date}else if(e.state==u.STOPPED){for(var t=e.files.length-1;t>=0;t--){if(e.files[t].status==u.UPLOADING){e.files[t].status=u.QUEUED;w()}}}}function D(){if(v){v.abort()}}function C(e){w();n(function(){x.call(e)},1)}function N(e,t){if(t.code===u.INIT_ERROR){e.destroy()}else if(t.code===u.HTTP_ERROR){t.file.status=u.FAILED;t.file.completeTimestamp=+new Date;y(t.file);if(e.state==u.STARTED){e.trigger("CancelUpload");n(function(){x.call(e)},1)}}}function M(e){e.stop();u.each(c,function(e){e.destroy()});c=[];if(d.length){u.each(d,function(e){e.destroy()});d=[]}if(m.length){u.each(m,function(e){e.destroy()});m=[]}f={};g=false;h=v=null;p.reset()}l={chunk_size:0,file_data_name:"file",filters:{mime_types:[],max_file_size:0,prevent_duplicates:false,prevent_empty:true},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:true,multi_selection:true,resize:false,runtimes:s.order,send_file_name:true,send_chunk_number:true,silverlight_xap_url:"js/Moxie.xap"};I.call(this,e,null,true);p=new u.QueueProgress;u.extend(this,{id:o,uid:o,state:u.STOPPED,features:{},runtime:null,files:c,settings:l,total:p,init:function(){var e=this,t,i,n;i=e.getOption("preinit");if(typeof i=="function"){i(e)}else{u.each(i,function(t,i){e.bind(i,t)})}E.call(e);u.each(["container","browse_button","drop_element"],function(t){if(e.getOption(t)===null){n={code:u.INIT_ERROR,message:u.sprintf(u.translate("%s specified, but cannot be found."),t)};return false}});if(n){return e.trigger("Error",n)}if(!l.browse_button&&!l.drop_element){return e.trigger("Error",{code:u.INIT_ERROR,message:u.translate("You must specify either browse_button or drop_element.")})}b.call(e,l,function(t){var i=e.getOption("init");if(typeof i=="function"){i(e)}else{u.each(i,function(t,i){e.bind(i,t)})}if(t){e.runtime=s.getInfo(_()).type;e.trigger("Init",{runtime:e.runtime});e.trigger("PostInit")}else{e.trigger("Error",{code:u.INIT_ERROR,message:u.translate("Init error.")})}})},setOption:function(e,t){I.call(this,e,t,!this.runtime)},getOption:function(e){if(!e){return l}return l[e]},refresh:function(){if(d.length){u.each(d,function(e){e.trigger("Refresh")})}this.trigger("Refresh")},start:function(){if(this.state!=u.STARTED){this.state=u.STARTED;this.trigger("StateChanged");x.call(this)}},
stop:function(){if(this.state!=u.STOPPED){this.state=u.STOPPED;this.trigger("StateChanged");this.trigger("CancelUpload")}},disableBrowse:function(){g=arguments[0]!==i?arguments[0]:true;if(d.length){u.each(d,function(e){e.disable(g)})}this.trigger("DisableBrowse",g)},getFile:function(e){var t;for(t=c.length-1;t>=0;t--){if(c[t].id===e){return c[t]}}},addFile:function(e,i){var o=this,s=[],a=[],l;function f(e,t){var i=[];u.each(o.settings.filters,function(t,n){if(r[n]){i.push(function(i){r[n].call(o,t,e,function(e){i(!e)})})}});u.inSeries(i,t)}function d(e){var r=u.typeOf(e);if(e instanceof t.file.File){if(!e.ruid&&!e.isDetached()){if(!l){return false}e.ruid=l;e.connectRuntime(l)}d(new u.File(e))}else if(e instanceof t.file.Blob){d(e.getSource());e.destroy()}else if(e instanceof u.File){if(i){e.name=i}s.push(function(t){f(e,function(i){if(!i){c.push(e);a.push(e);o.trigger("FileFiltered",e)}n(t,1)})})}else if(u.inArray(r,["file","blob"])!==-1){d(new t.file.File(null,e))}else if(r==="node"&&u.typeOf(e.files)==="filelist"){u.each(e.files,d)}else if(r==="array"){i=null;u.each(e,d)}}l=_();d(e);if(s.length){u.inSeries(s,function(){if(a.length){o.trigger("FilesAdded",a)}})}},removeFile:function(e){var t=typeof e==="string"?e:e.id;for(var i=c.length-1;i>=0;i--){if(c[i].id===t){return this.splice(i,1)[0]}}},splice:function(e,t){var n=c.splice(e===i?0:e,t===i?c.length:t);var r=false;if(this.state==u.STARTED){u.each(n,function(e){if(e.status===u.UPLOADING){r=true;return false}});if(r){this.stop()}}this.trigger("FilesRemoved",n);u.each(n,function(e){e.destroy()});if(r){this.start()}return n},dispatchEvent:function(e){var t,i,n;e=e.toLowerCase();t=this.hasEventListener(e);if(t){t.sort(function(e,t){return t.priority-e.priority});i=[].slice.call(arguments);i.shift();i.unshift(this);for(var r=0;r<t.length;r++){if(t[r].fn.apply(t[r].scope,i)===false){return false}}}return true},bind:function(e,t,i,n){u.Uploader.prototype.bind.call(this,e,t,n,i)},destroy:function(){this.trigger("Destroy");l=p=null;this.unbindAll()}})};u.Uploader.prototype=t.core.EventTarget.instance;u.File=function(){var e={};function t(t){u.extend(this,{id:u.guid(),name:t.name||t.fileName,type:t.type||"",relativePath:t.relativePath||"",size:t.fileSize||t.size,origSize:t.fileSize||t.size,loaded:0,percent:0,status:u.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),completeTimestamp:0,getNative:function(){var e=this.getSource().getSource();return u.inArray(u.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){if(!e[this.id]){return null}return e[this.id]},destroy:function(){var t=this.getSource();if(t){t.destroy();delete e[this.id]}}});e[this.id]=t}return t}();u.QueueProgress=function(){var e=this;e.size=0;e.loaded=0;e.uploaded=0;e.failed=0;e.queued=0;e.percent=0;e.bytesPerSec=0;e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}};e.plupload=u})(this,moxie);